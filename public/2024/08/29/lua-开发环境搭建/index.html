<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>lua 开发环境搭建 | 野鬼圣经</title><meta name="author" content="潼关路边的一只野鬼"><meta name="copyright" content="潼关路边的一只野鬼"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="luarocks 的基本使用">
<meta property="og:type" content="article">
<meta property="og:title" content="lua 开发环境搭建">
<meta property="og:url" content="https://laolang2016.github.io/2024/08/29/lua-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/index.html">
<meta property="og:site_name" content="野鬼圣经">
<meta property="og:description" content="luarocks 的基本使用">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://laolang2016.github.io/upload/avatar.jpg">
<meta property="article:published_time" content="2024-08-29T09:12:33.000Z">
<meta property="article:modified_time" content="2024-08-29T09:24:16.246Z">
<meta property="article:author" content="潼关路边的一只野鬼">
<meta property="article:tag" content="graver">
<meta property="article:tag" content="lua">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://laolang2016.github.io/upload/avatar.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://laolang2016.github.io/2024/08/29/lua-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'lua 开发环境搭建',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-08-29 17:24:16'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/upload/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">70</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">61</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">63</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="野鬼圣经"><span class="site-name">野鬼圣经</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">lua 开发环境搭建</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-08-29T09:12:33.000Z" title="发表于 2024-08-29 17:12:33">2024-08-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-08-29T09:24:16.246Z" title="更新于 2024-08-29 17:24:16">2024-08-29</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/graver/">graver</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/graver/lua/">lua</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">7.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>45分钟</span></span></div></div></div><article class="post-content" id="article-container"><p>luarocks 的基本使用</p>
<span id="more"></span>

<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p>lua 官网: <a target="_blank" rel="noopener" href="https://www.lua.org/">https://www.lua.org/</a></p>
<p>luarocks 官网: <a target="_blank" rel="noopener" href="https://luarocks.org/">https://luarocks.org/</a></p>
<hr>
<p><a target="_blank" rel="noopener" href="https://panguangyu.blog.csdn.net/article/details/88775896">Lua 最全的快速入门教程</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1yv4y1g78G">lua从入门到进厂</a></p>
<p><a target="_blank" rel="noopener" href="https://www.codenong.com/cs110780708/">Lua 包管理 – Luarocks 使用指南</a></p>
<p><a target="_blank" rel="noopener" href="https://atom-l.github.io/lua5.4-manual-zh/">Lua 5.4 中文参考手册</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/91fac87bd6d3">linux 下编译Lua源码，同时生成 动态库.so 静态库.a 文件</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq826364410/article/details/88624824">【最详细易懂】C++和Lua交互总结</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1oT4y1B7DL">C++与Lua联合编程实战</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42317817/article/details/120666327">高性能混合编程：用脚本语言配合C++使用之Lua</a></p>
<p><a target="_blank" rel="noopener" href="https://indienova.com/indie-game-development/lua-as-script-with-cpp-development/">用 lua 脚本配合 C++ 开发</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/andylauren/article/details/99841848">（9）CMake入门笔记–同时生成动态库与静态库</a></p>
<h1 id="Linux-基本环境搭建"><a href="#Linux-基本环境搭建" class="headerlink" title="Linux 基本环境搭建"></a>Linux 基本环境搭建</h1><h2 id="lua-基本环境"><a href="#lua-基本环境" class="headerlink" title="lua 基本环境"></a>lua 基本环境</h2><h3 id="下载-lua"><a href="#下载-lua" class="headerlink" title="下载 lua"></a>下载 lua</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://www.lua.org/ftp/lua-5.4.2.tar.gz</span><br></pre></td></tr></table></figure>

<h3 id="编译-lua"><a href="#编译-lua" class="headerlink" title="编译 lua"></a>编译 lua</h3><p>直接 <code>make</code> 即可, 我把编译后的 <code>lua</code> 与 <code>luac</code> 放在了 <code>~/program/lua/lua542</code>, 然后将这个目录放入 <code>~/.bashrc</code> 即可</p>
<h3 id="测试-lua"><a href="#测试-lua" class="headerlink" title="测试 lua"></a>测试 lua</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:lua$ cat hello.lua </span><br><span class="line">print(&quot;Hello World&quot;)</span><br><span class="line">laolang@laolang-mint:lua$ lua hello.lua </span><br><span class="line">Hello World</span><br><span class="line">laolang@laolang-mint:lua$ </span><br></pre></td></tr></table></figure>

<h2 id="luarocks-基本环境"><a href="#luarocks-基本环境" class="headerlink" title="luarocks 基本环境"></a>luarocks 基本环境</h2><h3 id="下载-luarocks"><a href="#下载-luarocks" class="headerlink" title="下载 luarocks"></a>下载 luarocks</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://luarocks.org/releases/luarocks-3.11.1.tar.gz</span><br></pre></td></tr></table></figure>

<h3 id="安装-luarocks"><a href="#安装-luarocks" class="headerlink" title="安装 luarocks"></a>安装 luarocks</h3><p>解压后执行 <code>./configure</code> 提示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:luarocks-3.11.1$ ./configure </span><br><span class="line"></span><br><span class="line">Configuring LuaRocks version 3.11.1...</span><br><span class="line"></span><br><span class="line">Lua version detected: 5.4</span><br><span class="line">Lua interpreter found: /home/laolang/program/lua/lua542/lua</span><br><span class="line">lua.h for Lua 5.4 not found (tried /home/laolang/program/lua/include/lua/5.4/lua.h /home/laolang/program/lua/include/lua5.4/lua.h /home/laolang/program/lua/include/lua-5.4/lua.h /home/laolang/program/lua/include/lua54/lua.h /home/laolang/program/lua/include/lua.h)</span><br><span class="line"></span><br><span class="line">If the development files for Lua (headers and libraries)</span><br><span class="line">are installed in your system, you may need to use the</span><br><span class="line">--with-lua or --with-lua-include flags to specify their location.</span><br><span class="line"></span><br><span class="line">If those files are not yet installed, you need to install</span><br><span class="line">them using the appropriate method for your operating system.</span><br><span class="line"></span><br><span class="line">Run ./configure --help for details on flags.</span><br><span class="line"></span><br><span class="line">configure failed.</span><br><span class="line"></span><br><span class="line">laolang@laolang-mint:luarocks-3.11.1$ which lua</span><br><span class="line">/home/laolang/program/lua/lua542/lua</span><br><span class="line">laolang@laolang-mint:luarocks-3.11.1$ </span><br></pre></td></tr></table></figure>

<p>根据提示, 将 <code>lua</code> 头文件放入 <code>~/program/lua/include/lua/5.4</code> , 然后再次执行 <code>./configure</code><br><strong><code>lua</code> 头文件</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:5.4$ pwd</span><br><span class="line">/home/laolang/program/lua/include/lua/5.4</span><br><span class="line">laolang@laolang-mint:5.4$ l</span><br><span class="line">总计 216K</span><br><span class="line">-rw-r--r-- 1 laolang laolang 1.3K 2024-06-01 17:10:06 lapi.h</span><br><span class="line">-rw-r--r-- 1 laolang laolang 8.7K 2024-06-01 17:10:06 lauxlib.h</span><br><span class="line">-rw-r--r-- 1 laolang laolang 3.8K 2024-06-01 17:10:06 lcode.h</span><br><span class="line">-rw-r--r-- 1 laolang laolang 2.1K 2024-06-01 17:10:06 lctype.h</span><br><span class="line">-rw-r--r-- 1 laolang laolang 1.9K 2024-06-01 17:10:06 ldebug.h</span><br><span class="line">-rw-r--r-- 1 laolang laolang 2.8K 2024-06-01 17:10:06 ldo.h</span><br><span class="line">-rw-r--r-- 1 laolang laolang 1.8K 2024-06-01 17:10:06 lfunc.h</span><br><span class="line">-rw-r--r-- 1 laolang laolang 5.9K 2024-06-01 17:10:06 lgc.h</span><br><span class="line">-rw-r--r-- 1 laolang laolang 1.7K 2024-06-01 17:10:06 ljumptab.h</span><br><span class="line">-rw-r--r-- 1 laolang laolang 2.4K 2024-06-01 17:10:06 llex.h</span><br><span class="line">-rw-r--r-- 1 laolang laolang 8.8K 2024-06-01 17:10:06 llimits.h</span><br><span class="line">-rw-r--r-- 1 laolang laolang 3.3K 2024-06-01 17:10:06 lmem.h</span><br><span class="line">-rw-r--r-- 1 laolang laolang  22K 2024-06-01 17:10:06 lobject.h</span><br><span class="line">-rw-r--r-- 1 laolang laolang  13K 2024-06-01 17:10:06 lopcodes.h</span><br><span class="line">-rw-r--r-- 1 laolang laolang 1.2K 2024-06-01 17:10:06 lopnames.h</span><br><span class="line">-rw-r--r-- 1 laolang laolang 5.8K 2024-06-01 17:10:06 lparser.h</span><br><span class="line">-rw-r--r-- 1 laolang laolang  828 2024-06-01 17:10:06 lprefix.h</span><br><span class="line">-rw-r--r-- 1 laolang laolang  14K 2024-06-01 17:10:06 lstate.h</span><br><span class="line">-rw-r--r-- 1 laolang laolang 1.6K 2024-06-01 17:10:06 lstring.h</span><br><span class="line">-rw-r--r-- 1 laolang laolang 2.0K 2024-06-01 17:10:06 ltable.h</span><br><span class="line">-rw-r--r-- 1 laolang laolang 2.9K 2024-06-01 17:10:06 ltm.h</span><br><span class="line">-rw-r--r-- 1 laolang laolang  21K 2024-06-01 17:10:06 luaconf.h</span><br><span class="line">-rw-r--r-- 1 laolang laolang  16K 2024-06-01 17:10:06 lua.h</span><br><span class="line">-rw-r--r-- 1 laolang laolang  191 2024-06-01 17:10:06 lua.hpp</span><br><span class="line">-rw-r--r-- 1 laolang laolang 1.2K 2024-06-01 17:10:06 lualib.h</span><br><span class="line">-rw-r--r-- 1 laolang laolang  863 2024-06-01 17:10:06 lundump.h</span><br><span class="line">-rw-r--r-- 1 laolang laolang 4.3K 2024-06-01 17:10:06 lvm.h</span><br><span class="line">-rw-r--r-- 1 laolang laolang 1.5K 2024-06-01 17:10:06 lzio.h</span><br><span class="line">laolang@laolang-mint:5.4$ </span><br></pre></td></tr></table></figure>

<p><strong><code>./configure</code></strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:luarocks-3.11.1$ ./configure </span><br><span class="line"></span><br><span class="line">Configuring LuaRocks version 3.11.1...</span><br><span class="line"></span><br><span class="line">Lua version detected: 5.4</span><br><span class="line">Lua interpreter found: /home/laolang/program/lua/lua542/lua</span><br><span class="line">lua.h found: /home/laolang/program/lua/include/lua/5.4/lua.h</span><br><span class="line">unzip found in PATH: /usr/bin</span><br><span class="line"></span><br><span class="line">Done configuring.</span><br><span class="line"></span><br><span class="line">LuaRocks will be installed at......: /usr/local</span><br><span class="line">LuaRocks will install rocks at.....: /usr/local</span><br><span class="line">LuaRocks configuration directory...: /usr/local/etc/luarocks</span><br><span class="line">Using Lua from.....................: /home/laolang/program/lua</span><br><span class="line"></span><br><span class="line">* Type make and make install:</span><br><span class="line">  to install to /usr/local as usual.</span><br><span class="line">* Type make bootstrap:</span><br><span class="line">  to install LuaRocks into /usr/local as a rock.</span><br><span class="line"></span><br><span class="line">laolang@laolang-mint:luarocks-3.11.1$ </span><br></pre></td></tr></table></figure>

<p>然后执行 <code>make &amp;&amp; sudo make install</code> 即可</p>
<h3 id="luarocks-安装后的配置"><a href="#luarocks-安装后的配置" class="headerlink" title="luarocks 安装后的配置"></a>luarocks 安装后的配置</h3><p>此时直接执行 <code>luarocks</code> 会提示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:lua-hello$ luarocks</span><br><span class="line">Variables:</span><br><span class="line">   Variables from the &quot;variables&quot; table of the configuration file can be</span><br><span class="line">   overridden with VAR=VALUE assignments.</span><br><span class="line"></span><br><span class="line">Configuration:</span><br><span class="line">   Lua:</span><br><span class="line">      Version    : 5.4</span><br><span class="line">      LUA        : /home/laolang/program/lua/lua542/lua (ok)</span><br><span class="line">      LUA_INCDIR : (lua.h not found) 看这里看这里看这里看这里看这里</span><br><span class="line">                   ****************************************</span><br><span class="line">                   Use the command</span><br><span class="line"></span><br><span class="line">                      luarocks config variables.LUA_INCDIR &lt;dir&gt;</span><br><span class="line"></span><br><span class="line">                   to fix the location</span><br><span class="line">                   ****************************************</span><br><span class="line">      LUA_LIBDIR : (Lua library itself not found)</span><br><span class="line">                   ****************************************</span><br><span class="line">                   Use the command</span><br><span class="line"></span><br><span class="line">                      luarocks config variables.LUA_LIBDIR &lt;dir&gt;</span><br><span class="line"></span><br><span class="line">                   to fix the location</span><br><span class="line">                   ****************************************</span><br><span class="line"></span><br><span class="line">   Configuration files:</span><br><span class="line">      System  : /usr/local/etc/luarocks/config-5.4.lua (ok)</span><br><span class="line">      User    : /home/laolang/.luarocks/config-5.4.lua (ok)</span><br><span class="line"></span><br><span class="line">   Rocks trees in use:</span><br><span class="line">      /home/laolang/.luarocks (&quot;user&quot;)</span><br><span class="line">      /usr/local (&quot;system&quot;)</span><br><span class="line"></span><br><span class="line">laolang@laolang-mint:lua-hello$ </span><br></pre></td></tr></table></figure>

<p>解决这个问题很简单, 只需要再复制一次 <code>lua</code> 头文件到 <code>lua</code> 可执行程序所在目录即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:lua542$ tree</span><br><span class="line">.</span><br><span class="line">├── include</span><br><span class="line">│   └── lua</span><br><span class="line">│       └── 5.4</span><br><span class="line">│           ├── lapi.h</span><br><span class="line">│           ├── lauxlib.h</span><br><span class="line">│           ├── lcode.h</span><br><span class="line">│           ├── lctype.h</span><br><span class="line">│           ├── ldebug.h</span><br><span class="line">│           ├── ldo.h</span><br><span class="line">│           ├── lfunc.h</span><br><span class="line">│           ├── lgc.h</span><br><span class="line">│           ├── ljumptab.h</span><br><span class="line">│           ├── llex.h</span><br><span class="line">│           ├── llimits.h</span><br><span class="line">│           ├── lmem.h</span><br><span class="line">│           ├── lobject.h</span><br><span class="line">│           ├── lopcodes.h</span><br><span class="line">│           ├── lopnames.h</span><br><span class="line">│           ├── lparser.h</span><br><span class="line">│           ├── lprefix.h</span><br><span class="line">│           ├── lstate.h</span><br><span class="line">│           ├── lstring.h</span><br><span class="line">│           ├── ltable.h</span><br><span class="line">│           ├── ltm.h</span><br><span class="line">│           ├── luaconf.h</span><br><span class="line">│           ├── lua.h</span><br><span class="line">│           ├── lua.hpp</span><br><span class="line">│           ├── lualib.h</span><br><span class="line">│           ├── lundump.h</span><br><span class="line">│           ├── lvm.h</span><br><span class="line">│           └── lzio.h</span><br><span class="line">├── lua</span><br><span class="line">└── luac</span><br><span class="line"></span><br><span class="line">3 directories, 30 files</span><br><span class="line">laolang@laolang-mint:lua542$ </span><br></pre></td></tr></table></figure>

<h3 id="luarocks-安装库测试"><a href="#luarocks-安装库测试" class="headerlink" title="luarocks 安装库测试"></a>luarocks 安装库测试</h3><p>然后安装两个库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">luarocks install --tree=rocks luasocket</span><br><span class="line">luarocks install --tree=rocks lualogging</span><br></pre></td></tr></table></figure>

<p>安装过程如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:lua-hello$ luarocks install --tree=rocks luasocket</span><br><span class="line">Installing https://luarocks.org/luasocket-3.1.0-1.src.rock</span><br><span class="line"></span><br><span class="line">luasocket 3.1.0-1 depends on lua &gt;= 5.1 (5.4-1 provided by VM: success)</span><br><span class="line">gcc -O2 -fPIC -I/home/laolang/program/lua/lua542/include/lua/5.4 -c src/luasocket.c -o src/luasocket.o -DLUASOCKET_DEBUG</span><br><span class="line">gcc -O2 -fPIC -I/home/laolang/program/lua/lua542/include/lua/5.4 -c src/timeout.c -o src/timeout.o -DLUASOCKET_DEBUG</span><br><span class="line">gcc -O2 -fPIC -I/home/laolang/program/lua/lua542/include/lua/5.4 -c src/buffer.c -o src/buffer.o -DLUASOCKET_DEBUG</span><br><span class="line">gcc -O2 -fPIC -I/home/laolang/program/lua/lua542/include/lua/5.4 -c src/io.c -o src/io.o -DLUASOCKET_DEBUG</span><br><span class="line">gcc -O2 -fPIC -I/home/laolang/program/lua/lua542/include/lua/5.4 -c src/auxiliar.c -o src/auxiliar.o -DLUASOCKET_DEBUG</span><br><span class="line">gcc -O2 -fPIC -I/home/laolang/program/lua/lua542/include/lua/5.4 -c src/options.c -o src/options.o -DLUASOCKET_DEBUG</span><br><span class="line">gcc -O2 -fPIC -I/home/laolang/program/lua/lua542/include/lua/5.4 -c src/inet.c -o src/inet.o -DLUASOCKET_DEBUG</span><br><span class="line">gcc -O2 -fPIC -I/home/laolang/program/lua/lua542/include/lua/5.4 -c src/except.c -o src/except.o -DLUASOCKET_DEBUG</span><br><span class="line">gcc -O2 -fPIC -I/home/laolang/program/lua/lua542/include/lua/5.4 -c src/select.c -o src/select.o -DLUASOCKET_DEBUG</span><br><span class="line">gcc -O2 -fPIC -I/home/laolang/program/lua/lua542/include/lua/5.4 -c src/tcp.c -o src/tcp.o -DLUASOCKET_DEBUG</span><br><span class="line">gcc -O2 -fPIC -I/home/laolang/program/lua/lua542/include/lua/5.4 -c src/udp.c -o src/udp.o -DLUASOCKET_DEBUG</span><br><span class="line">gcc -O2 -fPIC -I/home/laolang/program/lua/lua542/include/lua/5.4 -c src/compat.c -o src/compat.o -DLUASOCKET_DEBUG</span><br><span class="line">gcc -O2 -fPIC -I/home/laolang/program/lua/lua542/include/lua/5.4 -c src/usocket.c -o src/usocket.o -DLUASOCKET_DEBUG</span><br><span class="line">gcc  -shared -o /tmp/luarocks_build-LuaSocket-3.1.0-1-9566323/socket/core.so src/luasocket.o src/timeout.o src/buffer.o src/io.o src/auxiliar.o src/options.o src/inet.o src/except.o src/select.o src/tcp.o src/udp.o src/compat.o src/usocket.o</span><br><span class="line">gcc -O2 -fPIC -I/home/laolang/program/lua/lua542/include/lua/5.4 -c src/buffer.c -o src/buffer.o -DLUASOCKET_DEBUG</span><br><span class="line">gcc -O2 -fPIC -I/home/laolang/program/lua/lua542/include/lua/5.4 -c src/compat.c -o src/compat.o -DLUASOCKET_DEBUG</span><br><span class="line">gcc -O2 -fPIC -I/home/laolang/program/lua/lua542/include/lua/5.4 -c src/auxiliar.c -o src/auxiliar.o -DLUASOCKET_DEBUG</span><br><span class="line">gcc -O2 -fPIC -I/home/laolang/program/lua/lua542/include/lua/5.4 -c src/options.c -o src/options.o -DLUASOCKET_DEBUG</span><br><span class="line">gcc -O2 -fPIC -I/home/laolang/program/lua/lua542/include/lua/5.4 -c src/timeout.c -o src/timeout.o -DLUASOCKET_DEBUG</span><br><span class="line">gcc -O2 -fPIC -I/home/laolang/program/lua/lua542/include/lua/5.4 -c src/io.c -o src/io.o -DLUASOCKET_DEBUG</span><br><span class="line">gcc -O2 -fPIC -I/home/laolang/program/lua/lua542/include/lua/5.4 -c src/usocket.c -o src/usocket.o -DLUASOCKET_DEBUG</span><br><span class="line">gcc -O2 -fPIC -I/home/laolang/program/lua/lua542/include/lua/5.4 -c src/serial.c -o src/serial.o -DLUASOCKET_DEBUG</span><br><span class="line">gcc  -shared -o /tmp/luarocks_build-LuaSocket-3.1.0-1-9566323/socket/serial.so src/buffer.o src/compat.o src/auxiliar.o src/options.o src/timeout.o src/io.o src/usocket.o src/serial.o</span><br><span class="line">gcc -O2 -fPIC -I/home/laolang/program/lua/lua542/include/lua/5.4 -c src/mime.c -o src/mime.o -DLUASOCKET_DEBUG</span><br><span class="line">gcc -O2 -fPIC -I/home/laolang/program/lua/lua542/include/lua/5.4 -c src/compat.c -o src/compat.o -DLUASOCKET_DEBUG</span><br><span class="line">gcc  -shared -o /tmp/luarocks_build-LuaSocket-3.1.0-1-9566323/mime/core.so src/mime.o src/compat.o</span><br><span class="line">gcc -O2 -fPIC -I/home/laolang/program/lua/lua542/include/lua/5.4 -c src/buffer.c -o src/buffer.o -DLUASOCKET_DEBUG</span><br><span class="line">gcc -O2 -fPIC -I/home/laolang/program/lua/lua542/include/lua/5.4 -c src/compat.c -o src/compat.o -DLUASOCKET_DEBUG</span><br><span class="line">gcc -O2 -fPIC -I/home/laolang/program/lua/lua542/include/lua/5.4 -c src/auxiliar.c -o src/auxiliar.o -DLUASOCKET_DEBUG</span><br><span class="line">gcc -O2 -fPIC -I/home/laolang/program/lua/lua542/include/lua/5.4 -c src/options.c -o src/options.o -DLUASOCKET_DEBUG</span><br><span class="line">gcc -O2 -fPIC -I/home/laolang/program/lua/lua542/include/lua/5.4 -c src/timeout.c -o src/timeout.o -DLUASOCKET_DEBUG</span><br><span class="line">gcc -O2 -fPIC -I/home/laolang/program/lua/lua542/include/lua/5.4 -c src/io.c -o src/io.o -DLUASOCKET_DEBUG</span><br><span class="line">gcc -O2 -fPIC -I/home/laolang/program/lua/lua542/include/lua/5.4 -c src/usocket.c -o src/usocket.o -DLUASOCKET_DEBUG</span><br><span class="line">gcc -O2 -fPIC -I/home/laolang/program/lua/lua542/include/lua/5.4 -c src/unix.c -o src/unix.o -DLUASOCKET_DEBUG</span><br><span class="line">gcc -O2 -fPIC -I/home/laolang/program/lua/lua542/include/lua/5.4 -c src/unixdgram.c -o src/unixdgram.o -DLUASOCKET_DEBUG</span><br><span class="line">gcc -O2 -fPIC -I/home/laolang/program/lua/lua542/include/lua/5.4 -c src/unixstream.c -o src/unixstream.o -DLUASOCKET_DEBUG</span><br><span class="line">gcc  -shared -o /tmp/luarocks_build-LuaSocket-3.1.0-1-9566323/socket/unix.so src/buffer.o src/compat.o src/auxiliar.o src/options.o src/timeout.o src/io.o src/usocket.o src/unix.o src/unixdgram.o src/unixstream.o</span><br><span class="line">No existing manifest. Attempting to rebuild...</span><br><span class="line">luasocket 3.1.0-1 is now installed in /home/laolang/code/lua/lua-hello/rocks (license: MIT)</span><br><span class="line"></span><br><span class="line">laolang@laolang-mint:lua-hello$ luarocks install --tree=rocks lualogging</span><br><span class="line">Installing https://luarocks.org/lualogging-1.8.2-1.src.rock</span><br><span class="line"></span><br><span class="line">lualogging 1.8.2-1 depends on luasocket (3.1.0-1 installed: success)</span><br><span class="line">lualogging 1.8.2-1 is now installed in /home/laolang/code/lua/lua-hello/rocks (license: MIT/X11)</span><br><span class="line"></span><br><span class="line">laolang@laolang-mint:lua-hello$ </span><br></pre></td></tr></table></figure>


<p>测试文件内容如下</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">package</span>.<span class="built_in">path</span> = <span class="built_in">package</span>.<span class="built_in">path</span> .. <span class="string">&quot;;./rocks/share/lua/5.4/?.lua&quot;</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;logging&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> #<span class="built_in">arg</span> &gt; <span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">arg</span>[<span class="number">1</span>] ~= <span class="literal">nil</span> <span class="keyword">and</span> <span class="built_in">arg</span>[<span class="number">1</span>] == <span class="string">&quot;on&quot;</span> <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">local</span> dbg = <span class="built_in">require</span>(<span class="string">&quot;emmy_core&quot;</span>)</span><br><span class="line">        dbg.tcpListen(<span class="string">&quot;localhost&quot;</span>, <span class="number">9966</span>)</span><br><span class="line">        dbg.waitIDE()</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> Logging = <span class="built_in">require</span> <span class="string">&quot;logging&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> appender = <span class="function"><span class="keyword">function</span><span class="params">(self, level, message)</span></span></span><br><span class="line">    <span class="built_in">print</span>(level, message)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> logger = Logging.new(appender)</span><br><span class="line">logger:setLevel(logger.INFO)</span><br><span class="line">logger:info(<span class="string">&quot;Hello Lua&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:lua-hello$ lua main.lua </span><br><span class="line">INFO	Hello Lua</span><br><span class="line">laolang@laolang-mint:lua-hello$ </span><br></pre></td></tr></table></figure>

<h2 id="C-与-lua-混合编程"><a href="#C-与-lua-混合编程" class="headerlink" title="C++ 与 lua 混合编程"></a>C++ 与 lua 混合编程</h2><h3 id="创建-lua-动态库"><a href="#创建-lua-动态库" class="headerlink" title="创建 lua 动态库"></a>创建 lua 动态库</h3><h4 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:lua_lib$ tree</span><br><span class="line">.</span><br><span class="line">├── CMakeLists.txt</span><br><span class="line">├── CMakePresets.json</span><br><span class="line">├── include</span><br><span class="line">│   ├── lapi.h</span><br><span class="line">│   ├── lauxlib.h</span><br><span class="line">│   ├── lcode.h</span><br><span class="line">│   ├── lctype.h</span><br><span class="line">│   ├── ldebug.h</span><br><span class="line">│   ├── ldo.h</span><br><span class="line">│   ├── lfunc.h</span><br><span class="line">│   ├── lgc.h</span><br><span class="line">│   ├── ljumptab.h</span><br><span class="line">│   ├── llex.h</span><br><span class="line">│   ├── llimits.h</span><br><span class="line">│   ├── lmem.h</span><br><span class="line">│   ├── lobject.h</span><br><span class="line">│   ├── lopcodes.h</span><br><span class="line">│   ├── lopnames.h</span><br><span class="line">│   ├── lparser.h</span><br><span class="line">│   ├── lprefix.h</span><br><span class="line">│   ├── lstate.h</span><br><span class="line">│   ├── lstring.h</span><br><span class="line">│   ├── ltable.h</span><br><span class="line">│   ├── ltm.h</span><br><span class="line">│   ├── luaconf.h</span><br><span class="line">│   ├── lua.h</span><br><span class="line">│   ├── lua.hpp</span><br><span class="line">│   ├── lualib.h</span><br><span class="line">│   ├── lundump.h</span><br><span class="line">│   ├── lvm.h</span><br><span class="line">│   └── lzio.h</span><br><span class="line">└── src</span><br><span class="line">    ├── lapi.c</span><br><span class="line">    ├── lauxlib.c</span><br><span class="line">    ├── lbaselib.c</span><br><span class="line">    ├── lcode.c</span><br><span class="line">    ├── lcorolib.c</span><br><span class="line">    ├── lctype.c</span><br><span class="line">    ├── ldblib.c</span><br><span class="line">    ├── ldebug.c</span><br><span class="line">    ├── ldo.c</span><br><span class="line">    ├── ldump.c</span><br><span class="line">    ├── lfunc.c</span><br><span class="line">    ├── lgc.c</span><br><span class="line">    ├── linit.c</span><br><span class="line">    ├── liolib.c</span><br><span class="line">    ├── llex.c</span><br><span class="line">    ├── lmathlib.c</span><br><span class="line">    ├── lmem.c</span><br><span class="line">    ├── loadlib.c</span><br><span class="line">    ├── lobject.c</span><br><span class="line">    ├── lopcodes.c</span><br><span class="line">    ├── loslib.c</span><br><span class="line">    ├── lparser.c</span><br><span class="line">    ├── lstate.c</span><br><span class="line">    ├── lstring.c</span><br><span class="line">    ├── lstrlib.c</span><br><span class="line">    ├── ltable.c</span><br><span class="line">    ├── ltablib.c</span><br><span class="line">    ├── ltm.c</span><br><span class="line">    ├── lundump.c</span><br><span class="line">    ├── lutf8lib.c</span><br><span class="line">    ├── lvm.c</span><br><span class="line">    └── lzio.c</span><br><span class="line"></span><br><span class="line">2 directories, 62 files</span><br><span class="line">laolang@laolang-mint:lua_lib$ </span><br></pre></td></tr></table></figure>

<h4 id="CMakeLists-txt"><a href="#CMakeLists-txt" class="headerlink" title="CMakeLists.txt"></a>CMakeLists.txt</h4><blockquote>
<p><strong>注意:</strong><br><strong><code>src</code> 目录中没有 <code>lua.c</code> 和 <code>luac.c</code></strong><br><strong>其实有也不要紧, 在 CMakeLists.txt 中手动指定了源文件列表</strong></p>
</blockquote>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.26</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(CMAKE_C_STANDARD <span class="number">17</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_C_STANDARD_REQUIRED <span class="keyword">True</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_C_EXTENSIONS <span class="keyword">OFF</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">project</span>(lua LANGUAGES C)</span><br><span class="line"></span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>/<span class="keyword">include</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(src_list</span><br><span class="line">src/lapi.c</span><br><span class="line">src/lauxlib.c</span><br><span class="line">src/lbaselib.c</span><br><span class="line">src/lcode.c</span><br><span class="line">src/lcorolib.c</span><br><span class="line">src/lctype.c</span><br><span class="line">src/ldblib.c</span><br><span class="line">src/ldebug.c</span><br><span class="line">src/ldo.c</span><br><span class="line">src/ldump.c</span><br><span class="line">src/lfunc.c</span><br><span class="line">src/lgc.c</span><br><span class="line">src/linit.c</span><br><span class="line">src/liolib.c</span><br><span class="line">src/llex.c</span><br><span class="line">src/lmathlib.c</span><br><span class="line">src/lmem.c</span><br><span class="line">src/loadlib.c</span><br><span class="line">src/lobject.c</span><br><span class="line">src/lopcodes.c</span><br><span class="line">src/loslib.c</span><br><span class="line">src/lparser.c</span><br><span class="line">src/lstate.c</span><br><span class="line">src/lstring.c</span><br><span class="line">src/lstrlib.c</span><br><span class="line">src/ltable.c</span><br><span class="line">src/ltablib.c</span><br><span class="line">src/ltm.c</span><br><span class="line">src/lundump.c</span><br><span class="line">src/lutf8lib.c</span><br><span class="line">src/lvm.c</span><br><span class="line">src/lzio.c</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成动态库</span></span><br><span class="line"><span class="keyword">add_library</span>(<span class="variable">$&#123;PROJECT_NAME&#125;</span> SHARED <span class="variable">$&#123;src_list&#125;</span>)</span><br><span class="line"><span class="comment"># 设置动态库版本</span></span><br><span class="line"><span class="keyword">SET_TARGET_PROPERTIES</span>(<span class="variable">$&#123;PROJECT_NAME&#125;</span> PROPERTIES VERSION <span class="number">5.4</span>.<span class="number">2</span> SOVERSION <span class="number">5</span>)</span><br><span class="line"><span class="comment"># 生成静态库</span></span><br><span class="line"><span class="keyword">add_library</span>(<span class="variable">$&#123;PROJECT_NAME&#125;</span>_static STATIC <span class="variable">$&#123;src_list&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使动态库和静态库同时存在</span></span><br><span class="line"><span class="keyword">set_target_properties</span>(<span class="variable">$&#123;PROJECT_NAME&#125;</span>_static PROPERTIES OUTPUT_NAME <span class="variable">$&#123;PROJECT_NAME&#125;</span>)</span><br><span class="line"><span class="keyword">set_target_properties</span>(<span class="variable">$&#123;PROJECT_NAME&#125;</span> PROPERTIES CLEAN_DIRECT_OUTPUT <span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<h4 id="CMakePresets-json"><a href="#CMakePresets-json" class="headerlink" title="CMakePresets.json"></a>CMakePresets.json</h4><blockquote>
<p><strong>注意:<code>ninja</code>路径修改为自己的实际路径</strong></p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="number">6</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cmakeMinimumRequired&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;major&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;minor&quot;</span><span class="punctuation">:</span> <span class="number">26</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;patch&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;configurePresets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;windows-base&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;displayName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;preset base&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;通用设置&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cacheVariables&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;CMAKE_MAKE_PROGRAM&quot;</span><span class="punctuation">:</span> <span class="string">&quot;D:/program/qt/Tools/Ninja/ninja.exe&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;CMAKE_GENERATOR&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Ninja&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;CMAKE_C_COMPILER&quot;</span><span class="punctuation">:</span> <span class="string">&quot;D:/program/qt/Tools/mingw1120_64/bin/gcc.exe&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;CMAKE_C_FLAGS&quot;</span><span class="punctuation">:</span> <span class="string">&quot;-Wall -Wextra&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;windows-release&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;displayName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;windows release&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;使用 ninja 与 g++ 构建 release 版本&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;inherits&quot;</span><span class="punctuation">:</span> <span class="string">&quot;windows-base&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;binaryDir&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;sourceDir&#125;/build/ninja-release&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cacheVariables&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;CMAKE_BUILD_TYPE&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Release&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;windows-debug&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;displayName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;windows debug&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;使用 ninja 与 g++ 构建 debug 版本&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;inherits&quot;</span><span class="punctuation">:</span> <span class="string">&quot;windows-base&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;binaryDir&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;sourceDir&#125;/build/ninja-debug&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cacheVariables&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;CMAKE_BUILD_TYPE&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Debug&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;CMAKE_DEBUG_POSTFIX&quot;</span><span class="punctuation">:</span> <span class="string">&quot;d&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;linux-base&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;displayName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;preset base&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;通用设置&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cacheVariables&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;CMAKE_GENERATOR&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Ninja&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;CMAKE_MAKE_PROGRAM&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/home/laolang/.local/bin/ninja&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;CMAKE_C_COMPILER&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/usr/bin/gcc&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;CMAKE_C_FLAGS&quot;</span><span class="punctuation">:</span> <span class="string">&quot;-Wall -Wextra&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;linux-release&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;displayName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;linux release&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;使用 ninja 与 g++ 构建 release 版本&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;inherits&quot;</span><span class="punctuation">:</span> <span class="string">&quot;linux-base&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;binaryDir&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;sourceDir&#125;/build/ninja-release&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cacheVariables&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;CMAKE_BUILD_TYPE&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Release&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;linux-debug&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;displayName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;linux debug&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;使用 ninja 与 g++ 构建 debug 版本&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;inherits&quot;</span><span class="punctuation">:</span> <span class="string">&quot;linux-base&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;binaryDir&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;sourceDir&#125;/build/ninja-debug&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cacheVariables&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;CMAKE_BUILD_TYPE&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Debug&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;CMAKE_DEBUG_POSTFIX&quot;</span><span class="punctuation">:</span> <span class="string">&quot;d&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;buildPresets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;windows-release&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;configurePreset&quot;</span><span class="punctuation">:</span> <span class="string">&quot;windows-release&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;windows-debug&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;configurePreset&quot;</span><span class="punctuation">:</span> <span class="string">&quot;windows-debug&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;linux-release&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;configurePreset&quot;</span><span class="punctuation">:</span> <span class="string">&quot;linux-release&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;linux-debug&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;configurePreset&quot;</span><span class="punctuation">:</span> <span class="string">&quot;linux-debug&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="生成动态库"><a href="#生成动态库" class="headerlink" title="生成动态库"></a>生成动态库</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake --preset=linux-release &amp;&amp; cmake --build --preset=linux-release</span><br></pre></td></tr></table></figure>

<p>构建过程如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:lua_lib$ cmake --preset=linux-release &amp;&amp; cmake --build --preset=linux-release</span><br><span class="line">Preset CMake variables:</span><br><span class="line"></span><br><span class="line">  CMAKE_BUILD_TYPE=&quot;Release&quot;</span><br><span class="line">  CMAKE_C_COMPILER=&quot;/usr/bin/gcc&quot;</span><br><span class="line">  CMAKE_C_FLAGS=&quot;-Wall -Wextra&quot;</span><br><span class="line">  CMAKE_GENERATOR=&quot;Ninja&quot;</span><br><span class="line">  CMAKE_MAKE_PROGRAM=&quot;/home/laolang/.local/bin/ninja&quot;</span><br><span class="line"></span><br><span class="line">-- The C compiler identification is GNU 11.4.0</span><br><span class="line">-- Detecting C compiler ABI info</span><br><span class="line">-- Detecting C compiler ABI info - done</span><br><span class="line">-- Check for working C compiler: /usr/bin/gcc - skipped</span><br><span class="line">-- Detecting C compile features</span><br><span class="line">-- Detecting C compile features - done</span><br><span class="line">-- Configuring done (0.2s)</span><br><span class="line">-- Generating done (0.0s)</span><br><span class="line">-- Build files have been written to: /home/laolang/program/lua/lua_lib/build/ninja-release</span><br><span class="line">[64/67] Linking C shared library liblua.so.5.4.2</span><br><span class="line">/usr/bin/ld: CMakeFiles/lua.dir/src/loslib.c.o: in function `os_tmpname&#x27;:</span><br><span class="line">loslib.c:(.text+0x405): 警告： the use of `tmpnam&#x27; is dangerous, better use `mkstemp&#x27;</span><br><span class="line">[67/67] Linking C static library liblua.a</span><br><span class="line">laolang@laolang-mint:lua_lib$ l build/ninja-release/</span><br><span class="line">总计 1.1M</span><br><span class="line">-rw-rw-r-- 1 laolang laolang  53K 2024-06-01 17:28:58 build.ninja</span><br><span class="line">-rw-rw-r-- 1 laolang laolang  13K 2024-06-01 17:28:58 CMakeCache.txt</span><br><span class="line">drwxrwxr-x 7 laolang laolang 4.0K 2024-06-01 17:28:58 CMakeFiles/</span><br><span class="line">-rw-rw-r-- 1 laolang laolang 1.7K 2024-06-01 17:28:58 cmake_install.cmake</span><br><span class="line">-rw-rw-r-- 1 laolang laolang 595K 2024-06-01 17:29:00 liblua.a</span><br><span class="line">lrwxrwxrwx 1 laolang laolang   11 2024-06-01 17:28:59 liblua.so -&gt; liblua.so.5*</span><br><span class="line">lrwxrwxrwx 1 laolang laolang   15 2024-06-01 17:28:59 liblua.so.5 -&gt; liblua.so.5.4.2*</span><br><span class="line">-rwxrwxr-x 1 laolang laolang 353K 2024-06-01 17:28:59 liblua.so.5.4.2*</span><br><span class="line">laolang@laolang-mint:lua_lib$ </span><br></pre></td></tr></table></figure>


<h3 id="使用动态库"><a href="#使用动态库" class="headerlink" title="使用动态库"></a>使用动态库</h3><h4 id="目录结构-1"><a href="#目录结构-1" class="headerlink" title="目录结构"></a>目录结构</h4><blockquote>
<p><strong>注意:</strong><br><strong>需要复制上一步编译好的 <code>lua</code> 动态库</strong></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:test$ tree</span><br><span class="line">.</span><br><span class="line">├── CMakeLists.txt</span><br><span class="line">├── CMakePresets.json</span><br><span class="line">├── copylib.sh</span><br><span class="line">├── lib</span><br><span class="line">│   ├── liblua.so</span><br><span class="line">│   ├── liblua.so.5</span><br><span class="line">│   └── liblua.so.5.4.2</span><br><span class="line">├── lua</span><br><span class="line">│   └── main.lua</span><br><span class="line">├── main.cpp</span><br><span class="line">├── Makefile</span><br><span class="line">└── third</span><br><span class="line">    └── lua</span><br><span class="line">        ├── lapi.h</span><br><span class="line">        ├── lauxlib.h</span><br><span class="line">        ├── lcode.h</span><br><span class="line">        ├── lctype.h</span><br><span class="line">        ├── ldebug.h</span><br><span class="line">        ├── ldo.h</span><br><span class="line">        ├── lfunc.h</span><br><span class="line">        ├── lgc.h</span><br><span class="line">        ├── ljumptab.h</span><br><span class="line">        ├── llex.h</span><br><span class="line">        ├── llimits.h</span><br><span class="line">        ├── lmem.h</span><br><span class="line">        ├── lobject.h</span><br><span class="line">        ├── lopcodes.h</span><br><span class="line">        ├── lopnames.h</span><br><span class="line">        ├── lparser.h</span><br><span class="line">        ├── lprefix.h</span><br><span class="line">        ├── lstate.h</span><br><span class="line">        ├── lstring.h</span><br><span class="line">        ├── ltable.h</span><br><span class="line">        ├── ltm.h</span><br><span class="line">        ├── luaconf.h</span><br><span class="line">        ├── lua.h</span><br><span class="line">        ├── lua.hpp</span><br><span class="line">        ├── lualib.h</span><br><span class="line">        ├── lundump.h</span><br><span class="line">        ├── lvm.h</span><br><span class="line">        └── lzio.h</span><br><span class="line"></span><br><span class="line">4 directories, 37 files</span><br><span class="line">laolang@laolang-mint:test$ </span><br></pre></td></tr></table></figure>

<h4 id="main-cpp"><a href="#main-cpp" class="headerlink" title="main.cpp"></a>main.cpp</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;lua/lauxlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;lua/lua.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;lua/lualib.h&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建 lua 状态</span></span><br><span class="line">    lua_State *L = <span class="built_in">luaL_newstate</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 启用基本的 lua 库</span></span><br><span class="line">    <span class="built_in">luaopen_base</span>(L);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 加载 lua 文件</span></span><br><span class="line">    <span class="built_in">luaL_loadfile</span>(L, <span class="string">&quot;main.lua&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 运行 lua 文件</span></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">lua_pcall</span>(L, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;ret:&quot;</span> &lt;&lt; ret &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="CMakeLists-txt-1"><a href="#CMakeLists-txt-1" class="headerlink" title="CMakeLists.txt"></a>CMakeLists.txt</h4><blockquote>
<p>注意 windows 与 linux 的区别</p>
</blockquote>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 指定 cmake 最小版本, 意指 cmake 版本小于指定版本则构建过程终止</span></span><br><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.26</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#[[</span></span><br><span class="line"><span class="comment">    语言环境配置</span></span><br><span class="line"><span class="comment">]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 语言版本</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">17</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果指定的语言版本不受支持, 则构建过程终止</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD_REQUIRED <span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只弃用 ISO C++ 标准的编译器标志, 而不使用特定编译器的扩展</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_EXTENSIONS <span class="keyword">OFF</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(UNIX)</span><br><span class="line">    <span class="comment"># 将 install_rpath 的设置应用在 build_rpath 上 避免在开发期间出现动态库找不到的问题</span></span><br><span class="line">    <span class="keyword">set</span>(CMAKE_BUILD_WITH_INSTALL_RPATH <span class="keyword">True</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">#[[</span></span><br><span class="line"><span class="comment">    项目配置</span></span><br><span class="line"><span class="comment">]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 项目名称和语言</span></span><br><span class="line"><span class="keyword">project</span>( graver LANGUAGES CXX VERSION <span class="number">1.0</span>.<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发布目录</span></span><br><span class="line"><span class="keyword">set</span>(dist_dir <span class="variable">$&#123;CMAKE_BINARY_DIR&#125;</span>/dist)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 二进制文件目录</span></span><br><span class="line"><span class="keyword">set</span>(bin_dir <span class="variable">$&#123;dist_dir&#125;</span>/bin)</span><br><span class="line"><span class="keyword">file</span>(<span class="keyword">MAKE_DIRECTORY</span> <span class="variable">$&#123;bin_dir&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(UNIX)</span><br><span class="line">    <span class="comment"># 库文件目录</span></span><br><span class="line">    <span class="keyword">set</span>(lib_dir <span class="variable">$&#123;dist_dir&#125;</span>/lib)</span><br><span class="line">    <span class="keyword">file</span>(<span class="keyword">MAKE_DIRECTORY</span> <span class="variable">$&#123;lib_dir&#125;</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">#[[</span></span><br><span class="line"><span class="comment">    编译相关配置</span></span><br><span class="line"><span class="comment">]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成 compile_commands.json</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_EXPORT_COMPILE_COMMANDS <span class="keyword">ON</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制 lua 脚本</span></span><br><span class="line"><span class="keyword">configure_file</span>(<span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>/lua/main.lua <span class="variable">$&#123;bin_dir&#125;</span>/)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 包含全局头文件</span></span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>/third)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加库链接路径</span></span><br><span class="line"><span class="comment"># 添加库链接路径</span></span><br><span class="line"><span class="keyword">if</span>(UNIX)</span><br><span class="line">    <span class="keyword">link_directories</span>(<span class="variable">$&#123;lib_dir&#125;</span>)</span><br><span class="line"><span class="keyword">elseif</span>(WIN32)</span><br><span class="line">    <span class="keyword">link_directories</span>(<span class="variable">$&#123;bin_dir&#125;</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 源文件列表</span></span><br><span class="line"><span class="keyword">aux_source_directory</span>(. SRCS_MAIN)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成可执行程序</span></span><br><span class="line"><span class="keyword">add_executable</span>(<span class="variable">$&#123;PROJECT_NAME&#125;</span> <span class="variable">$&#123;SRCS_MAIN&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 链接 lua 库</span></span><br><span class="line"><span class="keyword">target_link_libraries</span>(<span class="variable">$&#123;PROJECT_NAME&#125;</span> lua)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可执行程序路径</span></span><br><span class="line"><span class="keyword">set_target_properties</span>(<span class="variable">$&#123;PROJECT_NAME&#125;</span> PROPERTIES RUNTIME_OUTPUT_DIRECTORY <span class="variable">$&#123;bin_dir&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置可执行程序 rpath</span></span><br><span class="line"><span class="keyword">if</span>(UNIX)</span><br><span class="line">    <span class="keyword">set_target_properties</span>(<span class="variable">$&#123;PROJECT_NAME&#125;</span> PROPERTIES INSTALL_RPATH <span class="string">&quot;\$&#123;ORIGIN&#125;/../lib&quot;</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<h4 id="CMakePresets-json-1"><a href="#CMakePresets-json-1" class="headerlink" title="CMakePresets.json"></a>CMakePresets.json</h4><blockquote>
<p><strong>注意:</strong><br><strong>将 <code>g++</code> <code>ninja</code> 等设置为自己的实际路径</strong></p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="number">6</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cmakeMinimumRequired&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;major&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;minor&quot;</span><span class="punctuation">:</span> <span class="number">26</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;patch&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;configurePresets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;windows-base&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;displayName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;preset base&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;通用设置&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cacheVariables&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;CMAKE_MAKE_PROGRAM&quot;</span><span class="punctuation">:</span> <span class="string">&quot;D:/program/qt/Tools/Ninja/ninja.exe&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;CMAKE_GENERATOR&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Ninja&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;CMAKE_CXX_COMPILER&quot;</span><span class="punctuation">:</span> <span class="string">&quot;D:/program/qt/Tools/mingw1120_64/bin/g++.exe&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;CMAKE_CXX_FLAGS&quot;</span><span class="punctuation">:</span> <span class="string">&quot;-Wall -Wextra&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;windows-release&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;displayName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;windows release&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;使用 ninja 与 g++ 构建 release 版本&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;inherits&quot;</span><span class="punctuation">:</span> <span class="string">&quot;windows-base&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;binaryDir&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;sourceDir&#125;/build/ninja-release&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cacheVariables&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;CMAKE_BUILD_TYPE&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Release&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;windows-debug&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;displayName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;windows debug&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;使用 ninja 与 g++ 构建 debug 版本&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;inherits&quot;</span><span class="punctuation">:</span> <span class="string">&quot;windows-base&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;binaryDir&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;sourceDir&#125;/build/ninja-debug&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cacheVariables&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;CMAKE_BUILD_TYPE&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Debug&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;CMAKE_DEBUG_POSTFIX&quot;</span><span class="punctuation">:</span> <span class="string">&quot;d&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;linux-base&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;displayName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;preset base&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;通用设置&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cacheVariables&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;CMAKE_MAKE_PROGRAM&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/home/laolang/.local/bin/ninja&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;CMAKE_GENERATOR&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Ninja&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;CMAKE_CXX_COMPILER&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/usr/bin/g++&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;CMAKE_CXX_FLAGS&quot;</span><span class="punctuation">:</span> <span class="string">&quot;-Wall -Wextra&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;linux-release&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;displayName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;linux release&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;使用 ninja 与 g++ 构建 release 版本&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;inherits&quot;</span><span class="punctuation">:</span> <span class="string">&quot;linux-base&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;binaryDir&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;sourceDir&#125;/build/ninja-release&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cacheVariables&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;CMAKE_BUILD_TYPE&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Release&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;linux-debug&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;displayName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;linux debug&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;使用 ninja 与 g++ 构建 debug 版本&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;inherits&quot;</span><span class="punctuation">:</span> <span class="string">&quot;linux-base&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;binaryDir&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;sourceDir&#125;/build/ninja-debug&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cacheVariables&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;CMAKE_BUILD_TYPE&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Debug&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;CMAKE_DEBUG_POSTFIX&quot;</span><span class="punctuation">:</span> <span class="string">&quot;d&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;buildPresets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;windows-release&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;configurePreset&quot;</span><span class="punctuation">:</span> <span class="string">&quot;windows-release&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;windows-debug&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;configurePreset&quot;</span><span class="punctuation">:</span> <span class="string">&quot;windows-debug&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;linux-release&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;configurePreset&quot;</span><span class="punctuation">:</span> <span class="string">&quot;linux-release&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;linux-debug&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;configurePreset&quot;</span><span class="punctuation">:</span> <span class="string">&quot;linux-debug&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="copylib-sh"><a href="#copylib-sh" class="headerlink" title="copylib.sh"></a>copylib.sh</h4><blockquote>
<p>注意 windows 和 linux 的区别</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$OSTYPE</span>&quot;</span> == <span class="string">&quot;linux-gnu&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">mkdir</span> -p build/ninja-release/dist/lib</span><br><span class="line">    <span class="built_in">cp</span> lib/liblua.so*.* build/ninja-release/dist/lib/</span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$MSYSTEM</span>&quot;</span> == <span class="string">&quot;MINGW64&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">	<span class="built_in">mkdir</span> -p build/ninja-release/dist/bin</span><br><span class="line">	<span class="built_in">cp</span> lib/*.dll build/ninja-release/dist/bin/</span><br><span class="line">    <span class="built_in">cp</span> lib/*.dll.a build/ninja-release/dist/bin/</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h4 id="Makefile"><a href="#Makefile" class="headerlink" title="Makefile"></a>Makefile</h4><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">ALL:run</span></span><br><span class="line"></span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: copylib configure build run rebuild rerun clean format</span></span><br><span class="line"><span class="section">copylib:</span></span><br><span class="line">	bash copylib.sh</span><br><span class="line"></span><br><span class="line"><span class="section">configure: copylib</span></span><br><span class="line">	cmake --preset=linux-release</span><br><span class="line"><span class="section">build: configure</span></span><br><span class="line">	cmake --build --preset=linux-release</span><br><span class="line"><span class="section">run: build</span></span><br><span class="line">	cd build/ninja-release/dist/bin &amp;&amp; ./graver</span><br><span class="line"><span class="section">rebuild: clean build</span></span><br><span class="line"><span class="section">rerun: rebuild run</span></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">	rm -rf build</span><br><span class="line"><span class="section">format:</span></span><br><span class="line">	<span class="comment"># 格式化 c++ 代码</span></span><br><span class="line">	find src -type f \( -name <span class="string">&quot;*.c&quot;</span> -o -name <span class="string">&quot;*.cc&quot;</span> -o -name <span class="string">&quot;*.cpp&quot;</span> -o -name <span class="string">&quot;*.h&quot;</span> -o -name <span class="string">&quot;*.hpp&quot;</span> \) -exec clang-format -style=file:.clang-format -i &#123;&#125; \;</span><br><span class="line">	find <span class="keyword">include</span> -type f \( -name <span class="string">&quot;*.c&quot;</span> -o -name <span class="string">&quot;*.cc&quot;</span> -o -name <span class="string">&quot;*.cpp&quot;</span> -o -name <span class="string">&quot;*.h&quot;</span> -o -name <span class="string">&quot;*.hpp&quot;</span> \) -exec clang-format -style=file:.clang-format -i &#123;&#125; \;</span><br><span class="line">	<span class="comment"># 格式化 CMakeLists.txt</span></span><br><span class="line">	cmake-format -c .cmake-format.py -i CMakeLists.txt</span><br><span class="line">	cmake-format -c .cmake-format.py -i src/CMakeLists.txt</span><br><span class="line">	cmake-format -c .cmake-format.py -i src/app/CMakeLists.txt</span><br><span class="line">	cmake-format -c .cmake-format.py -i src/lua/CMakeLists.txt</span><br></pre></td></tr></table></figure>

<h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><p>直接 <code>make</code> 即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:test$ make</span><br><span class="line">bash copylib.sh</span><br><span class="line">cmake --preset=linux-release</span><br><span class="line">Preset CMake variables:</span><br><span class="line"></span><br><span class="line">  CMAKE_BUILD_TYPE=&quot;Release&quot;</span><br><span class="line">  CMAKE_CXX_COMPILER=&quot;/usr/bin/g++&quot;</span><br><span class="line">  CMAKE_CXX_FLAGS=&quot;-Wall -Wextra&quot;</span><br><span class="line">  CMAKE_GENERATOR=&quot;Ninja&quot;</span><br><span class="line">  CMAKE_MAKE_PROGRAM=&quot;/home/laolang/.local/bin/ninja&quot;</span><br><span class="line"></span><br><span class="line">-- The CXX compiler identification is GNU 11.4.0</span><br><span class="line">-- Detecting CXX compiler ABI info</span><br><span class="line">-- Detecting CXX compiler ABI info - done</span><br><span class="line">-- Check for working CXX compiler: /usr/bin/g++ - skipped</span><br><span class="line">-- Detecting CXX compile features</span><br><span class="line">-- Detecting CXX compile features - done</span><br><span class="line">-- Configuring done (0.1s)</span><br><span class="line">-- Generating done (0.0s)</span><br><span class="line">-- Build files have been written to: /home/laolang/code/lua/lua542/test/build/ninja-release</span><br><span class="line">cmake --build --preset=linux-release</span><br><span class="line">[2/2] Linking CXX executable dist/bin/graver</span><br><span class="line">cd build/ninja-release/dist/bin &amp;&amp; ./graver</span><br><span class="line">Hello lua</span><br><span class="line">ret:0</span><br><span class="line">laolang@laolang-mint:test$ </span><br></pre></td></tr></table></figure>

<h1 id="windows-基本环境搭建"><a href="#windows-基本环境搭建" class="headerlink" title="windows 基本环境搭建"></a>windows 基本环境搭建</h1><h2 id="lua-基本环境-1"><a href="#lua-基本环境-1" class="headerlink" title="lua 基本环境"></a>lua 基本环境</h2><h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><blockquote>
<p><strong>注意:</strong><br><strong>需要下载二进制包和源码包</strong></p>
</blockquote>
<p>二进制包</p>
<p><a target="_blank" rel="noopener" href="https://luabinaries.sourceforge.net/download.html">https://luabinaries.sourceforge.net/download.html</a></p>
<p><img src="/images/2024-08-29-lua_%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/001.png"></p>
<p>源码包</p>
<p><a target="_blank" rel="noopener" href="https://www.lua.org/ftp/lua-5.4.2.tar.gz">https://www.lua.org/ftp/lua-5.4.2.tar.gz</a></p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>将下载的两个二进制包的内容全部解压到同一个目录, 有提示覆盖, 直接是, 覆盖即可</p>
<p><img src="/images/2024-08-29-lua_%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/002.png"></p>
<p>然后将 <code>lua54.exe</code> 和 <code>lua54c.exe</code> 复制一份并改名, 再将目录添加到 path</p>
<p><img src="/images/2024-08-29-lua_%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/003.png"></p>
<h3 id="测试-lua-1"><a href="#测试-lua-1" class="headerlink" title="测试 lua"></a>测试 lua</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">E:\code\lua\lua-hello&gt;type main.lua</span><br><span class="line">print(&quot;Hello Lua&quot;)</span><br><span class="line"></span><br><span class="line">E:\code\lua\lua-hello&gt;lua main.lua</span><br><span class="line">Hello Lua</span><br><span class="line"></span><br><span class="line">E:\code\lua\lua-hello&gt;</span><br></pre></td></tr></table></figure>

<h2 id="luarocks"><a href="#luarocks" class="headerlink" title="luarocks"></a>luarocks</h2><h3 id="下载-1"><a href="#下载-1" class="headerlink" title="下载"></a>下载</h3><p><a target="_blank" rel="noopener" href="http://luarocks.github.io/luarocks/releases/">http://luarocks.github.io/luarocks/releases/</a></p>
<p><img src="/images/2024-08-29-lua_%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/004.png"></p>
<p><a target="_blank" rel="noopener" href="http://luarocks.github.io/luarocks/releases/luarocks-3.11.1-windows-64.zip">http://luarocks.github.io/luarocks/releases/luarocks-3.11.1-windows-64.zip</a></p>
<p>然后将 luarocks 压缩包的内容全部解压到 lua.exe 所在目录</p>
<p><img src="/images/2024-08-29-lua_%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/005.png"></p>
<h3 id="安装后的配置"><a href="#安装后的配置" class="headerlink" title="安装后的配置"></a>安装后的配置</h3><p>此时直接运行 luarocks 提示如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Variables:</span><br><span class="line">   Variables from the &quot;variables&quot; table of the configuration file can be</span><br><span class="line">   overridden with VAR=VALUE assignments.</span><br><span class="line"></span><br><span class="line">Configuration:</span><br><span class="line">   Lua:</span><br><span class="line">      Version    : 5.4</span><br><span class="line">      LUA        : D:\program\lua\lua542\bin\lua54.exe (ok)</span><br><span class="line">      LUA_INCDIR : D:\program\lua\lua542\bin/include (lua.h not found) 看这里 看这里 看这里</span><br><span class="line">                   ****************************************</span><br><span class="line">                   Use the command</span><br><span class="line"></span><br><span class="line">                      luarocks config variables.LUA_INCDIR &lt;dir&gt;</span><br><span class="line"></span><br><span class="line">                   to fix the location</span><br><span class="line">                   ****************************************</span><br><span class="line">      LUA_LIBDIR : D:/program/lua/lua542/bin (ok)</span><br><span class="line"></span><br><span class="line">   Configuration files:</span><br><span class="line">      System  : C:\Program Files\luarocks\config-5.4.lua (not found)</span><br><span class="line">      User    : C:\Users\laolang\AppData\Roaming\luarocks\config-5.4.lua (ok)</span><br><span class="line"></span><br><span class="line">   Rocks trees in use:</span><br><span class="line">      C:\Users\laolang\AppData\Roaming\luarocks (&quot;user&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">E:\code\lua\lua-hello&gt;</span><br></pre></td></tr></table></figure>

<p>根据提示复制头文件即可</p>
<p><img src="/images/2024-08-29-lua_%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/006.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">E:\code\lua\lua-hello&gt;luarocks</span><br><span class="line"></span><br><span class="line">Variables:</span><br><span class="line">   Variables from the &quot;variables&quot; table of the configuration file can be</span><br><span class="line">   overridden with VAR=VALUE assignments.</span><br><span class="line"></span><br><span class="line">Configuration:</span><br><span class="line">   Lua:</span><br><span class="line">      Version    : 5.4</span><br><span class="line">      LUA        : D:\program\lua\lua542\bin\lua54.exe (ok) 看这三行 </span><br><span class="line">      LUA_INCDIR : D:\program\lua\lua542\bin/include (ok) 看这三行</span><br><span class="line">      LUA_LIBDIR : D:/program/lua/lua542/bin (ok) 看这三行</span><br><span class="line"></span><br><span class="line">   Configuration files:</span><br><span class="line">      System  : C:\Program Files\luarocks\config-5.4.lua (not found)</span><br><span class="line">      User    : C:\Users\laolang\AppData\Roaming\luarocks\config-5.4.lua (ok)</span><br><span class="line"></span><br><span class="line">   Rocks trees in use:</span><br><span class="line">      C:\Users\laolang\AppData\Roaming\luarocks (&quot;user&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">E:\code\lua\lua-hello&gt;</span><br></pre></td></tr></table></figure>

<h3 id="安装依赖的前置准备"><a href="#安装依赖的前置准备" class="headerlink" title="安装依赖的前置准备"></a>安装依赖的前置准备</h3><p>此时执行 <code>luarocks install --tree=rocks luasocket</code> 依然报错</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">E:\code\lua\lua-hello&gt;luarocks install --tree=rocks luasocket</span><br><span class="line">Installing https://luarocks.org/luasocket-3.1.0-1.src.rock</span><br><span class="line"></span><br><span class="line">luasocket 3.1.0-1 depends on lua &gt;= 5.1 (5.4-1 provided by VM: success)</span><br><span class="line">x86_64-w64-mingw32-gcc -O2 -c -o src/mime.o -ID:\program\lua\lua542\bin/include src/mime.c -DLUASOCKET_DEBUG -DWINVER=0x0501 -Ic:\windows\system32\include</span><br><span class="line">x86_64-w64-mingw32-gcc -O2 -c -o src/compat.o -ID:\program\lua\lua542\bin/include src/compat.c -DLUASOCKET_DEBUG -DWINVER=0x0501 -Ic:\windows\system32\include</span><br><span class="line">x86_64-w64-mingw32-gcc  -shared -o C:\Users\laolang\AppData\Local\Temp\luarocks_build-LuaSocket-3.1.0-1-299710\mime\core.dll src/mime.o src/compat.o -Lc:\windows\system32 D:\program\lua\lua542\bin\lua54.dll -lm</span><br><span class="line">D:/program/qt/Tools/mingw1120_64/bin/../lib/gcc/x86_64-w64-mingw32/11.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: D:/program/qt/Tools/mingw1120_64/bin/../lib/gcc/x86_64-w64-mingw32/11.2.0/../../../../x86_64-w64-mingw32/lib/../lib/dllcrt2.o:crtdll.c:(.text+0x16a): undefined reference to `_execute_onexit_table&#x27;</span><br><span class="line">D:/program/qt/Tools/mingw1120_64/bin/../lib/gcc/x86_64-w64-mingw32/11.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: D:/program/qt/Tools/mingw1120_64/bin/../lib/gcc/x86_64-w64-mingw32/11.2.0/../../../../x86_64-w64-mingw32/lib/../lib/dllcrt2.o:crtdll.c:(.text+0x8): undefined reference to `_initialize_onexit_table&#x27;</span><br><span class="line">D:/program/qt/Tools/mingw1120_64/bin/../lib/gcc/x86_64-w64-mingw32/11.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: D:/program/qt/Tools/mingw1120_64/bin/../lib/gcc/x86_64-w64-mingw32/11.2.0/../../../../x86_64-w64-mingw32/lib/../lib/dllcrt2.o:crtdll.c:(.text+0x35b): undefined reference to `_register_onexit_function&#x27;</span><br><span class="line">D:/program/qt/Tools/mingw1120_64/bin/../lib/gcc/x86_64-w64-mingw32/11.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: D:/program/qt/Tools/mingw1120_64/bin/../lib/gcc/x86_64-w64-mingw32/11.2.0/../../../../x86_64-w64-mingw32/lib/../lib/libmingw32.a(lib64_libmingw32_a-pseudo-reloc.o):pseudo-reloc.c:(.text+0x28): undefined reference to `__acrt_iob_func&#x27;</span><br><span class="line">D:/program/qt/Tools/mingw1120_64/bin/../lib/gcc/x86_64-w64-mingw32/11.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: D:/program/qt/Tools/mingw1120_64/bin/../lib/gcc/x86_64-w64-mingw32/11.2.0/../../../../x86_64-w64-mingw32/lib/../lib/libmingw32.a(lib64_libmingw32_a-pseudo-reloc.o):pseudo-reloc.c:(.text+0x51): undefined reference to `__acrt_iob_func&#x27;</span><br><span class="line">collect2.exe: error: ld returned 1 exit status</span><br><span class="line"></span><br><span class="line">Error: Build error: Failed compiling module mime\core.dll</span><br><span class="line"></span><br><span class="line">E:\code\lua\lua-hello&gt;</span><br></pre></td></tr></table></figure>

<p>这是因为运行环境不正确, 我们应该使用 visual studio 的命令行</p>
<p><img src="/images/2024-08-29-lua_%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/007.png"></p>
<p>此时依然会报错</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">**********************************************************************</span><br><span class="line">** Visual Studio 2022 Developer Command Prompt v17.9.1</span><br><span class="line">** Copyright (c) 2022 Microsoft Corporation</span><br><span class="line">**********************************************************************</span><br><span class="line">[vcvarsall.bat] Environment initialized for: &#x27;x64&#x27;</span><br><span class="line"></span><br><span class="line">E:\code\lua\lua-hello&gt;luarocks install --tree=rocks luasocket</span><br><span class="line">Installing https://luarocks.org/luasocket-3.1.0-1.src.rock</span><br><span class="line"></span><br><span class="line">luasocket 3.1.0-1 depends on lua &gt;= 5.1 (5.4-1 provided by VM: success)</span><br><span class="line"></span><br><span class="line">Error: Build error: Failed finding the Lua library. You can use `luarocks config variables.LUA_LIBDIR &lt;path&gt;` to set the correct location.</span><br><span class="line"></span><br><span class="line">E:\code\lua\lua-hello&gt;</span><br></pre></td></tr></table></figure>

<p>我们需要下载 visual studio 对应的静态库, visual studio 版本与 vc 版本的对应关系</p>
<table>
<thead>
<tr>
<th>VC 版本</th>
<th>_MSC_VER 宏的值</th>
<th>VS版本</th>
<th>MSVC toolset version</th>
</tr>
</thead>
<tbody><tr>
<td>VC6.0</td>
<td>1200</td>
<td>vs 6.0</td>
<td></td>
</tr>
<tr>
<td>VC7.0</td>
<td>1300</td>
<td>vs 2002</td>
<td></td>
</tr>
<tr>
<td>VC7.1</td>
<td>1310</td>
<td>vs 2003</td>
<td></td>
</tr>
<tr>
<td>VC8.0</td>
<td>1400</td>
<td>vs 2005</td>
<td>80</td>
</tr>
<tr>
<td>VC9.0</td>
<td>1500</td>
<td>vs 2008</td>
<td>90</td>
</tr>
<tr>
<td>VC10.0</td>
<td>1600</td>
<td>vs 2010</td>
<td>100</td>
</tr>
<tr>
<td>VC11.0</td>
<td>1700</td>
<td>vs 2012</td>
<td>110</td>
</tr>
<tr>
<td>VC12.0</td>
<td>1800</td>
<td>vs 2013</td>
<td>120</td>
</tr>
<tr>
<td>VC14.0</td>
<td>1900</td>
<td>vs 2015</td>
<td>140</td>
</tr>
<tr>
<td>VC15.0</td>
<td><code>[1910,1916]</code></td>
<td>vs 2017</td>
<td>141</td>
</tr>
<tr>
<td>VC16.0</td>
<td><code>[1920,1929]</code></td>
<td>vs 2019</td>
<td>142</td>
</tr>
<tr>
<td>VC17.0</td>
<td><code>[1930,)</code></td>
<td>vs 2022</td>
<td>143</td>
</tr>
</tbody></table>
<p>我的是 vs2022 , 所以下载的是 vc17.lib , 下载地址: <a target="_blank" rel="noopener" href="https://sourceforge.net/projects/luabinaries/files/5.4.2/Windows%20Libraries/Static/">https://sourceforge.net/projects/luabinaries/files/5.4.2/Windows%20Libraries/Static/</a></p>
<p><img src="/images/2024-08-29-lua_%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/008.png"></p>
<p>然后我们将静态库复制到 lua.exe 所在目录</p>
<p><img src="/images/2024-08-29-lua_%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/009.png"></p>
<p>再次执行如下命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">luarocks install --tree=rocks luasocket</span><br><span class="line">luarocks install --tree=rocks lualogging</span><br></pre></td></tr></table></figure>

<p>过程如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">E:\code\lua\lua-hello&gt;luarocks install --tree=rocks luasocket</span><br><span class="line">Installing https://luarocks.org/luasocket-3.1.0-1.src.rock</span><br><span class="line"></span><br><span class="line">luasocket 3.1.0-1 depends on lua &gt;= 5.1 (5.4-1 provided by VM: success)</span><br><span class="line">cl /nologo /MD /O2 -c -Fosrc/luasocket.obj -ID:\program\lua\lua542\bin/include src/luasocket.c -DLUASOCKET_DEBUG -DNDEBUG -Ic:\windows\system32\include</span><br><span class="line">luasocket.c</span><br><span class="line">cl /nologo /MD /O2 -c -Fosrc/timeout.obj -ID:\program\lua\lua542\bin/include src/timeout.c -DLUASOCKET_DEBUG -DNDEBUG -Ic:\windows\system32\include</span><br><span class="line">timeout.c</span><br><span class="line">cl /nologo /MD /O2 -c -Fosrc/buffer.obj -ID:\program\lua\lua542\bin/include src/buffer.c -DLUASOCKET_DEBUG -DNDEBUG -Ic:\windows\system32\include</span><br><span class="line">buffer.c</span><br><span class="line">cl /nologo /MD /O2 -c -Fosrc/io.obj -ID:\program\lua\lua542\bin/include src/io.c -DLUASOCKET_DEBUG -DNDEBUG -Ic:\windows\system32\include</span><br><span class="line">io.c</span><br><span class="line">cl /nologo /MD /O2 -c -Fosrc/auxiliar.obj -ID:\program\lua\lua542\bin/include src/auxiliar.c -DLUASOCKET_DEBUG -DNDEBUG -Ic:\windows\system32\include</span><br><span class="line">auxiliar.c</span><br><span class="line">cl /nologo /MD /O2 -c -Fosrc/options.obj -ID:\program\lua\lua542\bin/include src/options.c -DLUASOCKET_DEBUG -DNDEBUG -Ic:\windows\system32\include</span><br><span class="line">options.c</span><br><span class="line">cl /nologo /MD /O2 -c -Fosrc/inet.obj -ID:\program\lua\lua542\bin/include src/inet.c -DLUASOCKET_DEBUG -DNDEBUG -Ic:\windows\system32\include</span><br><span class="line">inet.c</span><br><span class="line">cl /nologo /MD /O2 -c -Fosrc/except.obj -ID:\program\lua\lua542\bin/include src/except.c -DLUASOCKET_DEBUG -DNDEBUG -Ic:\windows\system32\include</span><br><span class="line">except.c</span><br><span class="line">cl /nologo /MD /O2 -c -Fosrc/select.obj -ID:\program\lua\lua542\bin/include src/select.c -DLUASOCKET_DEBUG -DNDEBUG -Ic:\windows\system32\include</span><br><span class="line">select.c</span><br><span class="line">cl /nologo /MD /O2 -c -Fosrc/tcp.obj -ID:\program\lua\lua542\bin/include src/tcp.c -DLUASOCKET_DEBUG -DNDEBUG -Ic:\windows\system32\include</span><br><span class="line">tcp.c</span><br><span class="line">cl /nologo /MD /O2 -c -Fosrc/udp.obj -ID:\program\lua\lua542\bin/include src/udp.c -DLUASOCKET_DEBUG -DNDEBUG -Ic:\windows\system32\include</span><br><span class="line">udp.c</span><br><span class="line">cl /nologo /MD /O2 -c -Fosrc/compat.obj -ID:\program\lua\lua542\bin/include src/compat.c -DLUASOCKET_DEBUG -DNDEBUG -Ic:\windows\system32\include</span><br><span class="line">compat.c</span><br><span class="line">cl /nologo /MD /O2 -c -Fosrc/wsocket.obj -ID:\program\lua\lua542\bin/include src/wsocket.c -DLUASOCKET_DEBUG -DNDEBUG -Ic:\windows\system32\include</span><br><span class="line">wsocket.c</span><br><span class="line">link -dll -def:core.def -out:C:\Users\laolang\AppData\Local\Temp\luarocks_build-LuaSocket-3.1.0-1-3920812\socket\core.dll D:\program\lua\lua542\bin\lua54.lib src/luasocket.obj src/timeout.obj src/buffer.obj src/io.obj src/auxiliar.obj src/options.obj src/inet.obj src/except.obj src/select.obj src/tcp.obj src/udp.obj src/compat.obj src/wsocket.obj ws2_32.lib</span><br><span class="line">Microsoft (R) Incremental Linker Version 14.39.33520.0</span><br><span class="line">Copyright (C) Microsoft Corporation.  All rights reserved.</span><br><span class="line"></span><br><span class="line">  正在创建库 C:\Users\laolang\AppData\Local\Temp\luarocks_build-LuaSocket-3.1.0-1-3920812\socket\core.lib 和对象 C:\Users\laolang\AppData\Local\Temp\luarocks_build-LuaSocket-3.1.0-1-3920812\socket\core.exp</span><br><span class="line">LINK : warning LNK4098: 默认库“LIBCMT”与其他库的使用冲突；请使用 /NODEFAULTLIB:library</span><br><span class="line">cl /nologo /MD /O2 -c -Fosrc/mime.obj -ID:\program\lua\lua542\bin/include src/mime.c -DLUASOCKET_DEBUG -DNDEBUG -Ic:\windows\system32\include</span><br><span class="line">mime.c</span><br><span class="line">cl /nologo /MD /O2 -c -Fosrc/compat.obj -ID:\program\lua\lua542\bin/include src/compat.c -DLUASOCKET_DEBUG -DNDEBUG -Ic:\windows\system32\include</span><br><span class="line">compat.c</span><br><span class="line">link -dll -def:core.def -out:C:\Users\laolang\AppData\Local\Temp\luarocks_build-LuaSocket-3.1.0-1-3920812\mime\core.dll D:\program\lua\lua542\bin\lua54.lib src/mime.obj src/compat.obj -libpath:c:\windows\system32</span><br><span class="line">Microsoft (R) Incremental Linker Version 14.39.33520.0</span><br><span class="line">Copyright (C) Microsoft Corporation.  All rights reserved.</span><br><span class="line"></span><br><span class="line">  正在创建库 C:\Users\laolang\AppData\Local\Temp\luarocks_build-LuaSocket-3.1.0-1-3920812\mime\core.lib 和对象 C:\Users\laolang\AppData\Local\Temp\luarocks_build-LuaSocket-3.1.0-1-3920812\mime\core.exp</span><br><span class="line">LINK : warning LNK4098: 默认库“LIBCMT”与其他库的使用冲突；请使用 /NODEFAULTLIB:library</span><br><span class="line">No existing manifest. Attempting to rebuild...</span><br><span class="line">luasocket 3.1.0-1 is now installed in E:\code\lua\lua-hello\rocks (license: MIT)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">E:\code\lua\lua-hello&gt;luarocks install --tree=rocks lualogging</span><br><span class="line">Installing https://luarocks.org/lualogging-1.8.2-1.src.rock</span><br><span class="line"></span><br><span class="line">lualogging 1.8.2-1 depends on luasocket (3.1.0-1 installed: success)</span><br><span class="line">lualogging 1.8.2-1 is now installed in E:\code\lua\lua-hello\rocks (license: MIT/X11)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">E:\code\lua\lua-hello&gt;</span><br></pre></td></tr></table></figure>

<h3 id="测试脚本"><a href="#测试脚本" class="headerlink" title="测试脚本"></a>测试脚本</h3><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">package</span>.<span class="built_in">path</span> = <span class="built_in">package</span>.<span class="built_in">path</span> .. <span class="string">&quot;;./rocks/share/lua/5.4/?.lua&quot;</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;logging&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- if #arg &gt; 0 then</span></span><br><span class="line"><span class="comment">--     if arg[1] ~= nil and arg[1] == &quot;on&quot; then</span></span><br><span class="line"><span class="comment">--         local dbg = require(&quot;emmy_core&quot;)</span></span><br><span class="line"><span class="comment">--         dbg.tcpListen(&quot;localhost&quot;, 9966)</span></span><br><span class="line"><span class="comment">--         dbg.waitIDE()</span></span><br><span class="line"><span class="comment">--     end</span></span><br><span class="line"><span class="comment">-- end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> Logging = <span class="built_in">require</span> <span class="string">&quot;logging&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> appender = <span class="function"><span class="keyword">function</span><span class="params">(self, level, message)</span></span></span><br><span class="line">    <span class="built_in">print</span>(level, message)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> logger = Logging.new(appender)</span><br><span class="line">logger:setLevel(logger.INFO)</span><br><span class="line">logger:info(<span class="string">&quot;Hello Lua&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="测试结果"><a href="#测试结果" class="headerlink" title="测试结果"></a>测试结果</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">E:\code\lua\lua-hello&gt;lua main.lua</span><br><span class="line">INFO    Hello Lua</span><br><span class="line"></span><br><span class="line">E:\code\lua\lua-hello&gt;</span><br></pre></td></tr></table></figure>

<h2 id="C-与-lua-混合编程-1"><a href="#C-与-lua-混合编程-1" class="headerlink" title="C++ 与 lua 混合编程"></a>C++ 与 lua 混合编程</h2><blockquote>
<p><strong>注意:</strong><br><strong>需要在 <code>git bash</code> 中运行</strong></p>
</blockquote>
<p>将 linux 的工程直接复制到 windows </p>
<blockquote>
<p><strong>注意:</strong><br><strong>某些 exe 的路径修改为自己系统的实际值</strong></p>
</blockquote>
<p><img src="/images/2024-08-29-lua_%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/010.png"></p>
<h3 id="编译动态库"><a href="#编译动态库" class="headerlink" title="编译动态库"></a>编译动态库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">laolang@DESKTOP-O12ME4M MINGW64 /e/code/lua/lua542/lua_lib</span><br><span class="line">$ pwd</span><br><span class="line">/e/code/lua/lua542/lua_lib</span><br><span class="line"></span><br><span class="line">laolang@DESKTOP-O12ME4M MINGW64 /e/code/lua/lua542/lua_lib</span><br><span class="line">$ ll</span><br><span class="line">total 16</span><br><span class="line">-rw-r--r-- 1 laolang 197121 1070  6月  1 18:37 CMakeLists.txt</span><br><span class="line">-rw-r--r-- 1 laolang 197121 2986  6月  1 18:37 CMakePresets.json</span><br><span class="line">drwxr-xr-x 1 laolang 197121    0  6月  1 18:37 include/</span><br><span class="line">drwxr-xr-x 1 laolang 197121    0  6月  1 18:37 src/</span><br><span class="line"></span><br><span class="line">laolang@DESKTOP-O12ME4M MINGW64 /e/code/lua/lua542/lua_lib</span><br><span class="line">$ cmake --preset=windows-release</span><br><span class="line">Preset CMake variables:</span><br><span class="line"></span><br><span class="line">  CMAKE_BUILD_TYPE=&quot;Release&quot;</span><br><span class="line">  CMAKE_C_COMPILER=&quot;D:/program/qt/Tools/mingw1120_64/bin/gcc.exe&quot;</span><br><span class="line">  CMAKE_C_FLAGS=&quot;-Wall -Wextra&quot;</span><br><span class="line">  CMAKE_GENERATOR=&quot;Ninja&quot;</span><br><span class="line">  CMAKE_MAKE_PROGRAM=&quot;D:/program/qt/Tools/Ninja/ninja.exe&quot;</span><br><span class="line"></span><br><span class="line">-- The C compiler identification is GNU 11.2.0</span><br><span class="line">-- Detecting C compiler ABI info</span><br><span class="line">-- Detecting C compiler ABI info - done</span><br><span class="line">-- Check for working C compiler: D:/program/qt/Tools/mingw1120_64/bin/gcc.exe - skipped</span><br><span class="line">-- Detecting C compile features</span><br><span class="line">-- Detecting C compile features - done</span><br><span class="line">-- Configuring done (0.6s)</span><br><span class="line">-- Generating done (0.0s)</span><br><span class="line">-- Build files have been written to: E:/code/lua/lua542/lua_lib/build/ninja-release</span><br><span class="line"></span><br><span class="line">laolang@DESKTOP-O12ME4M MINGW64 /e/code/lua/lua542/lua_lib</span><br><span class="line">$ cmake --build --preset=windows-release</span><br><span class="line">[1/66] Building C object CMakeFiles/lua.dir/src/lcorolib.c.obj</span><br><span class="line">...</span><br><span class="line">[64/66] Linking C shared library liblua.dll</span><br><span class="line">[65/66] Building C object CMakeFiles/lua_static.dir/src/lvm.c.obj</span><br><span class="line">[66/66] Linking C static library liblua.a</span><br><span class="line"></span><br><span class="line">laolang@DESKTOP-O12ME4M MINGW64 /e/code/lua/lua542/lua_lib</span><br><span class="line">$ ls -l build/ninja-release/</span><br><span class="line">total 1112</span><br><span class="line">-rw-r--r-- 1 laolang 197121  52679  6月  1 18:39 build.ninja</span><br><span class="line">-rw-r--r-- 1 laolang 197121   1607  6月  1 18:39 cmake_install.cmake</span><br><span class="line">-rw-r--r-- 1 laolang 197121  14538  6月  1 18:39 CMakeCache.txt</span><br><span class="line">drwxr-xr-x 1 laolang 197121      0  6月  1 18:39 CMakeFiles/</span><br><span class="line">-rw-r--r-- 1 laolang 197121 433062  6月  1 18:39 liblua.a</span><br><span class="line">-rwxr-xr-x 1 laolang 197121 413755  6月  1 18:39 liblua.dll*</span><br><span class="line">-rw-r--r-- 1 laolang 197121 205782  6月  1 18:39 liblua.dll.a</span><br><span class="line"></span><br><span class="line">laolang@DESKTOP-O12ME4M MINGW64 /e/code/lua/lua542/lua_lib</span><br><span class="line">$</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="测试混编"><a href="#测试混编" class="headerlink" title="测试混编"></a>测试混编</h3><p>需要修改 Makefile</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">ALL:run</span><br><span class="line"></span><br><span class="line">.PHONY: copylib configure build run rebuild rerun clean format</span><br><span class="line">copylib:</span><br><span class="line">	bash copylib.sh</span><br><span class="line"></span><br><span class="line">configure: copylib</span><br><span class="line">	cmake --preset=windows-release # 注意这里</span><br><span class="line">build: configure</span><br><span class="line">	cmake --build --preset=windows-release # 以及这里</span><br><span class="line">run: build</span><br><span class="line">	cd build/ninja-release/dist/bin &amp;&amp; ./graver</span><br><span class="line">rebuild: clean build</span><br><span class="line">rerun: rebuild run</span><br><span class="line">clean:</span><br><span class="line">	rm -rf build</span><br><span class="line">format:</span><br><span class="line">	# 格式化 c++ 代码</span><br><span class="line">	find src -type f \( -name &quot;*.c&quot; -o -name &quot;*.cc&quot; -o -name &quot;*.cpp&quot; -o -name &quot;*.h&quot; -o -name &quot;*.hpp&quot; \) -exec clang-format -style=file:.clang-format -i &#123;&#125; \;</span><br><span class="line">	find include -type f \( -name &quot;*.c&quot; -o -name &quot;*.cc&quot; -o -name &quot;*.cpp&quot; -o -name &quot;*.h&quot; -o -name &quot;*.hpp&quot; \) -exec clang-format -style=file:.clang-format -i &#123;&#125; \;</span><br><span class="line">	# 格式化 CMakeLists.txt</span><br><span class="line">	cmake-format -c .cmake-format.py -i CMakeLists.txt</span><br><span class="line">	cmake-format -c .cmake-format.py -i src/CMakeLists.txt</span><br><span class="line">	cmake-format -c .cmake-format.py -i src/app/CMakeLists.txt</span><br><span class="line">	cmake-format -c .cmake-format.py -i src/lua/CMakeLists.txt</span><br></pre></td></tr></table></figure>

<p>需要把上一步编译的 dll 复制到 lib 目录</p>
<p>测试过程</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">laolang@DESKTOP-O12ME4M MINGW64 /e/code/lua/lua542/test</span><br><span class="line">$ pwd</span><br><span class="line">/e/code/lua/lua542/test</span><br><span class="line"></span><br><span class="line">laolang@DESKTOP-O12ME4M MINGW64 /e/code/lua/lua542/test</span><br><span class="line">$ ll</span><br><span class="line">total 18</span><br><span class="line">-rw-r--r-- 1 laolang 197121 1750  6月  1 18:49 CMakeLists.txt</span><br><span class="line">-rw-r--r-- 1 laolang 197121 2994  6月  1 18:36 CMakePresets.json</span><br><span class="line">-rwxr-xr-x 1 laolang 197121  320  6月  1 18:46 copylib.sh*</span><br><span class="line">drwxr-xr-x 1 laolang 197121    0  6月  1 18:45 lib/</span><br><span class="line">drwxr-xr-x 1 laolang 197121    0  6月  1 18:37 lua/</span><br><span class="line">-rw-r--r-- 1 laolang 197121  419  6月  1 18:36 main.cpp</span><br><span class="line">-rw-r--r-- 1 laolang 197121  925  6月  1 18:42 Makefile</span><br><span class="line">drwxr-xr-x 1 laolang 197121    0  6月  1 18:37 third/</span><br><span class="line"></span><br><span class="line">laolang@DESKTOP-O12ME4M MINGW64 /e/code/lua/lua542/test</span><br><span class="line">$ make</span><br><span class="line">bash copylib.sh</span><br><span class="line">cmake --preset=windows-release</span><br><span class="line">Preset CMake variables:</span><br><span class="line"></span><br><span class="line">  CMAKE_BUILD_TYPE=&quot;Release&quot;</span><br><span class="line">  CMAKE_CXX_COMPILER=&quot;D:/program/qt/Tools/mingw1120_64/bin/g++.exe&quot;</span><br><span class="line">  CMAKE_CXX_FLAGS=&quot;-Wall -Wextra&quot;</span><br><span class="line">  CMAKE_GENERATOR=&quot;Ninja&quot;</span><br><span class="line">  CMAKE_MAKE_PROGRAM=&quot;D:/program/qt/Tools/Ninja/ninja.exe&quot;</span><br><span class="line"></span><br><span class="line">-- The CXX compiler identification is GNU 11.2.0</span><br><span class="line">-- Detecting CXX compiler ABI info</span><br><span class="line">-- Detecting CXX compiler ABI info - done</span><br><span class="line">-- Check for working CXX compiler: D:/program/qt/Tools/mingw1120_64/bin/g++.exe - skipped</span><br><span class="line">-- Detecting CXX compile features</span><br><span class="line">-- Detecting CXX compile features - done</span><br><span class="line">-- Configuring done (0.6s)</span><br><span class="line">-- Generating done (0.0s)</span><br><span class="line">-- Build files have been written to: E:/code/lua/lua542/test/build/ninja-release</span><br><span class="line">cmake --build --preset=windows-release</span><br><span class="line">[1/2] Building CXX object CMakeFiles/graver.dir/main.cpp.obj</span><br><span class="line">[2/2] Linking CXX executable dist\bin\graver.exe</span><br><span class="line">cd build/ninja-release/dist/bin &amp;&amp; ./graver</span><br><span class="line">Hello lua</span><br><span class="line">ret:0</span><br><span class="line"></span><br><span class="line">laolang@DESKTOP-O12ME4M MINGW64 /e/code/lua/lua542/test</span><br><span class="line">$</span><br></pre></td></tr></table></figure>

<h1 id="待完成项"><a href="#待完成项" class="headerlink" title="待完成项"></a>待完成项</h1><ol>
<li>Makefile 优化</li>
<li>C++ 与 lua 混编时, 调用 luarocks 安装的依赖的问题</li>
<li>lua 源码加入到 C++ 工程, 一次性完成编译 lua 库与 C++ lua 混编</li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://laolang2016.github.io">潼关路边的一只野鬼</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://laolang2016.github.io/2024/08/29/lua-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">https://laolang2016.github.io/2024/08/29/lua-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://laolang2016.github.io" target="_blank">野鬼圣经</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/graver/">graver</a><a class="post-meta__tags" href="/tags/lua/">lua</a></div><div class="post_share"><div class="social-share" data-image="/upload/avatar.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/upload/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">潼关路边的一只野鬼</div><div class="author-info__description">论鬼是如何变成人的</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">70</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">61</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">63</div></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">1.</span> <span class="toc-text">参考资料</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Linux-%E5%9F%BA%E6%9C%AC%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">2.</span> <span class="toc-text">Linux 基本环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#lua-%E5%9F%BA%E6%9C%AC%E7%8E%AF%E5%A2%83"><span class="toc-number">2.1.</span> <span class="toc-text">lua 基本环境</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD-lua"><span class="toc-number">2.1.1.</span> <span class="toc-text">下载 lua</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%AF%91-lua"><span class="toc-number">2.1.2.</span> <span class="toc-text">编译 lua</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95-lua"><span class="toc-number">2.1.3.</span> <span class="toc-text">测试 lua</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#luarocks-%E5%9F%BA%E6%9C%AC%E7%8E%AF%E5%A2%83"><span class="toc-number">2.2.</span> <span class="toc-text">luarocks 基本环境</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD-luarocks"><span class="toc-number">2.2.1.</span> <span class="toc-text">下载 luarocks</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-luarocks"><span class="toc-number">2.2.2.</span> <span class="toc-text">安装 luarocks</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#luarocks-%E5%AE%89%E8%A3%85%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.3.</span> <span class="toc-text">luarocks 安装后的配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#luarocks-%E5%AE%89%E8%A3%85%E5%BA%93%E6%B5%8B%E8%AF%95"><span class="toc-number">2.2.4.</span> <span class="toc-text">luarocks 安装库测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#C-%E4%B8%8E-lua-%E6%B7%B7%E5%90%88%E7%BC%96%E7%A8%8B"><span class="toc-number">2.3.</span> <span class="toc-text">C++ 与 lua 混合编程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-lua-%E5%8A%A8%E6%80%81%E5%BA%93"><span class="toc-number">2.3.1.</span> <span class="toc-text">创建 lua 动态库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-number">2.3.1.1.</span> <span class="toc-text">目录结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CMakeLists-txt"><span class="toc-number">2.3.1.2.</span> <span class="toc-text">CMakeLists.txt</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CMakePresets-json"><span class="toc-number">2.3.1.3.</span> <span class="toc-text">CMakePresets.json</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%8A%A8%E6%80%81%E5%BA%93"><span class="toc-number">2.3.1.4.</span> <span class="toc-text">生成动态库</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%8A%A8%E6%80%81%E5%BA%93"><span class="toc-number">2.3.2.</span> <span class="toc-text">使用动态库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84-1"><span class="toc-number">2.3.2.1.</span> <span class="toc-text">目录结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#main-cpp"><span class="toc-number">2.3.2.2.</span> <span class="toc-text">main.cpp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CMakeLists-txt-1"><span class="toc-number">2.3.2.3.</span> <span class="toc-text">CMakeLists.txt</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CMakePresets-json-1"><span class="toc-number">2.3.2.4.</span> <span class="toc-text">CMakePresets.json</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#copylib-sh"><span class="toc-number">2.3.2.5.</span> <span class="toc-text">copylib.sh</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Makefile"><span class="toc-number">2.3.2.6.</span> <span class="toc-text">Makefile</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">2.3.2.7.</span> <span class="toc-text">测试</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#windows-%E5%9F%BA%E6%9C%AC%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">3.</span> <span class="toc-text">windows 基本环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#lua-%E5%9F%BA%E6%9C%AC%E7%8E%AF%E5%A2%83-1"><span class="toc-number">3.1.</span> <span class="toc-text">lua 基本环境</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD"><span class="toc-number">3.1.1.</span> <span class="toc-text">下载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">3.1.2.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95-lua-1"><span class="toc-number">3.1.3.</span> <span class="toc-text">测试 lua</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#luarocks"><span class="toc-number">3.2.</span> <span class="toc-text">luarocks</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD-1"><span class="toc-number">3.2.1.</span> <span class="toc-text">下载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">3.2.2.</span> <span class="toc-text">安装后的配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96%E7%9A%84%E5%89%8D%E7%BD%AE%E5%87%86%E5%A4%87"><span class="toc-number">3.2.3.</span> <span class="toc-text">安装依赖的前置准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E8%84%9A%E6%9C%AC"><span class="toc-number">3.2.4.</span> <span class="toc-text">测试脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C"><span class="toc-number">3.2.5.</span> <span class="toc-text">测试结果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#C-%E4%B8%8E-lua-%E6%B7%B7%E5%90%88%E7%BC%96%E7%A8%8B-1"><span class="toc-number">3.3.</span> <span class="toc-text">C++ 与 lua 混合编程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E5%8A%A8%E6%80%81%E5%BA%93"><span class="toc-number">3.3.1.</span> <span class="toc-text">编译动态库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E6%B7%B7%E7%BC%96"><span class="toc-number">3.3.2.</span> <span class="toc-text">测试混编</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BE%85%E5%AE%8C%E6%88%90%E9%A1%B9"><span class="toc-number">4.</span> <span class="toc-text">待完成项</span></a></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By 潼关路边的一只野鬼</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid@10.8.0/dist/mermaid.min.js').then(runMermaid)
  }

  btf.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div></body></html>