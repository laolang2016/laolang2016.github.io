<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>makefile 基本使用 | 野鬼圣经</title><meta name="author" content="潼关路边的一只野鬼"><meta name="copyright" content="潼关路边的一只野鬼"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="一个最简单的 Makefile目录结构1234567laolang@laolang-mint:make_cpp_hello$ tree.├── hello.cpp└── Makefile1 directory, 2 fileslaolang@laolang-mint:make_cpp_hello$   源码hello.cpp12345#include &lt;iostream&gt;int mai">
<meta property="og:type" content="article">
<meta property="og:title" content="makefile 基本使用">
<meta property="og:url" content="https://laolang2016.github.io/2024/11/09/makefile-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/index.html">
<meta property="og:site_name" content="野鬼圣经">
<meta property="og:description" content="一个最简单的 Makefile目录结构1234567laolang@laolang-mint:make_cpp_hello$ tree.├── hello.cpp└── Makefile1 directory, 2 fileslaolang@laolang-mint:make_cpp_hello$   源码hello.cpp12345#include &lt;iostream&gt;int mai">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://laolang2016.github.io/upload/avatar.jpg">
<meta property="article:published_time" content="2024-11-09T10:22:37.000Z">
<meta property="article:modified_time" content="2024-11-10T18:12:23.859Z">
<meta property="article:author" content="潼关路边的一只野鬼">
<meta property="article:tag" content="c++">
<meta property="article:tag" content="makefile">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://laolang2016.github.io/upload/avatar.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://laolang2016.github.io/2024/11/09/makefile-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'makefile 基本使用',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-11-11 02:12:23'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/upload/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">87</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">66</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">71</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="野鬼圣经"><span class="site-name">野鬼圣经</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">makefile 基本使用</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-11-09T10:22:37.000Z" title="发表于 2024-11-09 18:22:37">2024-11-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-11-10T18:12:23.859Z" title="更新于 2024-11-11 02:12:23">2024-11-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/c/">c++</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/c/makefile/">makefile</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">3.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>15分钟</span></span></div></div></div><article class="post-content" id="article-container"><h1 id="一个最简单的-Makefile"><a href="#一个最简单的-Makefile" class="headerlink" title="一个最简单的 Makefile"></a>一个最简单的 Makefile</h1><h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:make_cpp_hello$ tree</span><br><span class="line">.</span><br><span class="line">├── hello.cpp</span><br><span class="line">└── Makefile</span><br><span class="line"></span><br><span class="line">1 directory, 2 files</span><br><span class="line">laolang@laolang-mint:make_cpp_hello$ </span><br></pre></td></tr></table></figure>

<h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><h3 id="hello-cpp"><a href="#hello-cpp" class="headerlink" title="hello.cpp"></a>hello.cpp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Hello World&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Makefile"><a href="#Makefile" class="headerlink" title="Makefile"></a>Makefile</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">hello: hello.cpp</span></span><br><span class="line">	g++ -o hello hello.cpp</span><br></pre></td></tr></table></figure>

<h2 id="使用过程"><a href="#使用过程" class="headerlink" title="使用过程"></a>使用过程</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:make_cpp_hello$ ls -l</span><br><span class="line">total 8</span><br><span class="line">-rw-rw-r-- 1 laolang laolang 92 11月  9 18:21 hello.cpp</span><br><span class="line">-rw-rw-r-- 1 laolang laolang 40 11月  9 18:21 Makefile</span><br><span class="line">laolang@laolang-mint:make_cpp_hello$ make</span><br><span class="line">g++ -o hello hello.cpp</span><br><span class="line">laolang@laolang-mint:make_cpp_hello$ ls -l</span><br><span class="line">total 28</span><br><span class="line">-rwxrwxr-x 1 laolang laolang 16496 11月  9 18:32 hello</span><br><span class="line">-rw-rw-r-- 1 laolang laolang    92 11月  9 18:21 hello.cpp</span><br><span class="line">-rw-rw-r-- 1 laolang laolang    40 11月  9 18:21 Makefile</span><br><span class="line">laolang@laolang-mint:make_cpp_hello$ ./hello </span><br><span class="line">Hello World</span><br><span class="line">laolang@laolang-mint:make_cpp_hello$ </span><br></pre></td></tr></table></figure>

<h2 id="分两步编译"><a href="#分两步编译" class="headerlink" title="分两步编译"></a>分两步编译</h2><h3 id="Makefile-1"><a href="#Makefile-1" class="headerlink" title="Makefile"></a>Makefile</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">hello: hello.o</span></span><br><span class="line">	g++ hello.o -o hello</span><br><span class="line"><span class="section">hello.o: hello.cpp</span></span><br><span class="line">	g++ -c hello.cpp</span><br></pre></td></tr></table></figure>

<h3 id="使用过程-1"><a href="#使用过程-1" class="headerlink" title="使用过程"></a>使用过程</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:make_cpp_hello$ ls -l</span><br><span class="line">total 8</span><br><span class="line">-rw-rw-r-- 1 laolang laolang 92 11月  9 18:21 hello.cpp</span><br><span class="line">-rw-rw-r-- 1 laolang laolang 73 11月  9 18:33 Makefile</span><br><span class="line">laolang@laolang-mint:make_cpp_hello$ make</span><br><span class="line">g++ -c hello.cpp</span><br><span class="line">g++ hello.o -o hello</span><br><span class="line">laolang@laolang-mint:make_cpp_hello$ ls -l</span><br><span class="line">total 32</span><br><span class="line">-rwxrwxr-x 1 laolang laolang 16496 11月  9 18:33 hello</span><br><span class="line">-rw-rw-r-- 1 laolang laolang    92 11月  9 18:21 hello.cpp</span><br><span class="line">-rw-rw-r-- 1 laolang laolang  2128 11月  9 18:33 hello.o</span><br><span class="line">-rw-rw-r-- 1 laolang laolang    73 11月  9 18:33 Makefile</span><br><span class="line">laolang@laolang-mint:make_cpp_hello$ ./hello </span><br><span class="line">Hello World</span><br><span class="line">laolang@laolang-mint:make_cpp_hello$ </span><br></pre></td></tr></table></figure>

<h1 id="Makefile-文件名的命名与指定"><a href="#Makefile-文件名的命名与指定" class="headerlink" title="Makefile 文件名的命名与指定"></a>Makefile 文件名的命名与指定</h1><h2 id="命名方式"><a href="#命名方式" class="headerlink" title="命名方式"></a>命名方式</h2><p><code>make</code> 会自动查找 <code>Makefile</code> 文件,查找顺序为 <code>GNUmakefile</code> -&gt; <code>makefile</code> -&gt; <code>Makefile</code></p>
<p><strong>GNUmakefile</strong>: 不建议使用,因为只有 <code>GNU make</code> 会识别<br><strong>makefile</strong>: 可以使用, <code>GNU make</code> 和其他版本的 <code>make</code> 可以识别<br><strong>Makefile</strong>: 最常用, 建议使用该命名方式</p>
<h2 id="如何指定-Makefile-文件"><a href="#如何指定-Makefile-文件" class="headerlink" title="如何指定 Makefile 文件"></a>如何指定 Makefile 文件</h2><p>如果 <code>Makefile</code> 文件名比较特殊, 可在命令行指定</p>
<ol>
<li><code>make -f &lt;filename&gt;</code></li>
<li><code>make --file=&lt;filename&gt;</code></li>
</ol>
<h1 id="一个略复杂的-Makefile"><a href="#一个略复杂的-Makefile" class="headerlink" title="一个略复杂的 Makefile"></a>一个略复杂的 Makefile</h1><h2 id="源码下载"><a href="#源码下载" class="headerlink" title="源码下载"></a>源码下载</h2><p><a target="_blank" rel="noopener" href="https://github.com/mayerui/sudoku">https://github.com/mayerui/sudoku</a></p>
<h2 id="目录结构-1"><a href="#目录结构-1" class="headerlink" title="目录结构"></a>目录结构</h2><blockquote>
<p>此目录中的文件来自与 <code>sudoku/src</code> ,然后添加了一个 <code>Makefile</code> 文件</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:sudoku_make$ l</span><br><span class="line">total 76K</span><br><span class="line">-rw-rw-r-- 1 laolang laolang 2.4K 2024-11-09 23:09:12 block.cpp</span><br><span class="line">-rw-rw-r-- 1 laolang laolang  390 2024-11-09 23:09:17 block.h</span><br><span class="line">-rw-rw-r-- 1 laolang laolang 1.3K 2024-11-09 23:09:17 color.h</span><br><span class="line">-rw-rw-r-- 1 laolang laolang  752 2024-11-09 23:09:12 command.cpp</span><br><span class="line">-rw-rw-r-- 1 laolang laolang  809 2024-11-09 23:09:17 command.h</span><br><span class="line">-rw-rw-r-- 1 laolang laolang 1.2K 2024-11-09 23:09:17 common.h</span><br><span class="line">-rw-rw-r-- 1 laolang laolang  148 2024-11-09 23:09:17 display_symbol.h</span><br><span class="line">-rw-rw-r-- 1 laolang laolang 2.0K 2024-11-09 23:09:12 i18n.cpp</span><br><span class="line">-rw-rw-r-- 1 laolang laolang  566 2024-11-09 23:09:17 i18n.h</span><br><span class="line">-rw-rw-r-- 1 laolang laolang 1.8K 2024-11-09 23:09:12 input.cpp</span><br><span class="line">-rw-rw-r-- 1 laolang laolang  157 2024-11-09 23:09:17 input.h</span><br><span class="line">-rw-rw-r-- 1 laolang laolang 1.2K 2024-11-09 23:09:12 main.cpp</span><br><span class="line">-rw-rw-r-- 1 laolang laolang  782 2024-11-09 23:17:54 Makefile</span><br><span class="line">-rw-rw-r-- 1 laolang laolang 9.5K 2024-11-09 23:09:12 scene.cpp</span><br><span class="line">-rw-rw-r-- 1 laolang laolang 1.1K 2024-11-09 23:09:17 scene.h</span><br><span class="line">-rw-rw-r-- 1 laolang laolang  184 2024-11-09 23:13:45 system_env.hpp</span><br><span class="line">-rw-rw-r-- 1 laolang laolang 2.7K 2024-11-09 23:09:27 utility.inl</span><br><span class="line">laolang@laolang-mint:sudoku_make$ </span><br></pre></td></tr></table></figure>

<h2 id="一个简略的-Makefile"><a href="#一个简略的-Makefile" class="headerlink" title="一个简略的 Makefile"></a>一个简略的 Makefile</h2><h3 id="确定文件依赖关系的方法"><a href="#确定文件依赖关系的方法" class="headerlink" title="确定文件依赖关系的方法"></a>确定文件依赖关系的方法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:sudoku_make$ g++ -MM main.cpp</span><br><span class="line">main.o: main.cpp i18n.h input.h common.h scene.h block.h command.h \</span><br><span class="line"> system_env.hpp utility.inl</span><br><span class="line">laolang@laolang-mint:sudoku_make$ </span><br></pre></td></tr></table></figure>

<h3 id="Makefile-内容"><a href="#Makefile-内容" class="headerlink" title="Makefile 内容"></a>Makefile 内容</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">sudoku: block.o  command.o  i18n.o  input.o  main.o  scene.o</span><br><span class="line">	g++ -o sudoku block.o  command.o  i18n.o  input.o  main.o  scene.o</span><br><span class="line"></span><br><span class="line">block.o: block.cpp block.h common.h color.h display_symbol.h</span><br><span class="line">	g++ -c block.cpp -o block.o</span><br><span class="line"></span><br><span class="line">command.o: command.cpp scene.h common.h block.h command.h</span><br><span class="line">	g++ -c command.cpp -o command.o</span><br><span class="line"></span><br><span class="line">i18n.o: i18n.cpp i18n.h</span><br><span class="line">	g++ -c i18n.cpp -o i18n.o</span><br><span class="line"></span><br><span class="line">input.o: input.cpp common.h i18n.h utility.inl</span><br><span class="line">	g++ -c input.cpp -o input.o</span><br><span class="line"></span><br><span class="line">main.o: main.cpp i18n.h input.h common.h scene.h block.h command.h system_env.hpp utility.inl</span><br><span class="line">	g++ -c main.cpp -o main.o</span><br><span class="line"></span><br><span class="line">scene.o: scene.cpp scene.h common.h block.h command.h display_symbol.h i18n.h utility.inl color.h</span><br><span class="line">	g++ -c scene.cpp -o scene.o</span><br><span class="line"></span><br><span class="line">clean:</span><br><span class="line">	rm -rf sudoku</span><br><span class="line">	rm -rf block.o  command.o  i18n.o  input.o  main.o  scene.o</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="编译过程"><a href="#编译过程" class="headerlink" title="编译过程"></a>编译过程</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:sudoku_make$ make</span><br><span class="line">g++ -c block.cpp -o block.o</span><br><span class="line">g++ -c command.cpp -o command.o</span><br><span class="line">g++ -c i18n.cpp -o i18n.o</span><br><span class="line">g++ -c input.cpp -o input.o</span><br><span class="line">g++ -c main.cpp -o main.o</span><br><span class="line">g++ -c scene.cpp -o scene.o</span><br><span class="line">g++ -o sudoku block.o  command.o  i18n.o  input.o  main.o  scene.o</span><br><span class="line">laolang@laolang-mint:sudoku_make$ make</span><br><span class="line">make: &#x27;sudoku&#x27; is up to date.</span><br><span class="line">laolang@laolang-mint:sudoku_make$ make clean</span><br><span class="line">rm -rf sudoku</span><br><span class="line">rm -rf block.o  command.o  i18n.o  input.o  main.o  scene.o</span><br><span class="line">laolang@laolang-mint:sudoku_make$ </span><br></pre></td></tr></table></figure>

<h1 id="目标与伪目标"><a href="#目标与伪目标" class="headerlink" title="目标与伪目标"></a>目标与伪目标</h1><p><code>.DEFAULT_GOAL</code>: 指定默认的目标. 如果没有显示的指定, 则 <code>Makefile</code> 的第一个目标就是默认的目标<br><code>.PHONY</code>: 指定伪目标. <code>clean</code> 只是一个标签,不是一个需要生成的文件,使用 <code>.PHONY</code> 可以显示的指明 <code>clean</code> 是一个伪目标, 可避免文件名和伪目标重名. <code>main.o</code> 即是一个伪目标又是一个需要生成的文件, 此时每次执行都会生成 <code>main.o</code> , 也就会重新生成依赖 <code>main.o</code> 的目标<br><code>-rm -rf sudoku</code>: 意指无论文件是否存在,都不会报错</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">.DEFAULT_GOAL = sudoku</span><br><span class="line"></span><br><span class="line">sudoku: block.o  command.o  i18n.o  input.o  main.o  scene.o</span><br><span class="line">	g++ -o sudoku block.o  command.o  i18n.o  input.o  main.o  scene.o</span><br><span class="line"></span><br><span class="line">block.o: block.cpp block.h common.h color.h display_symbol.h</span><br><span class="line">	g++ -c block.cpp -o block.o</span><br><span class="line"></span><br><span class="line">command.o: command.cpp scene.h common.h block.h command.h</span><br><span class="line">	g++ -c command.cpp -o command.o</span><br><span class="line"></span><br><span class="line">i18n.o: i18n.cpp i18n.h</span><br><span class="line">	g++ -c i18n.cpp -o i18n.o</span><br><span class="line"></span><br><span class="line">input.o: input.cpp common.h i18n.h utility.inl</span><br><span class="line">	g++ -c input.cpp -o input.o</span><br><span class="line"></span><br><span class="line">main.o: main.cpp i18n.h input.h common.h scene.h block.h command.h system_env.hpp utility.inl</span><br><span class="line">	g++ -c main.cpp -o main.o</span><br><span class="line"></span><br><span class="line">scene.o: scene.cpp scene.h common.h block.h command.h display_symbol.h i18n.h utility.inl color.h</span><br><span class="line">	g++ -c scene.cpp -o scene.o</span><br><span class="line"></span><br><span class="line">.PHONY : clean main.o</span><br><span class="line">clean:</span><br><span class="line">	- rm -rf sudoku</span><br><span class="line">	- rm -rf block.o  command.o  i18n.o  input.o  main.o  scene.o</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h1><h2 id="依赖类型"><a href="#依赖类型" class="headerlink" title="依赖类型"></a>依赖类型</h2><p>之前的依赖形式都是普通依赖, 直接列在目标后面, 其有两个特点</p>
<ol>
<li>如果这一依赖是由其他规则生成的文件, 那么执行到这一目标前会先执行生成依赖的那一规则</li>
<li>如果任何一个依赖文件修改时间比目标晚, 那么就重新生成目标文件</li>
</ol>
<h2 id="order-only-依赖"><a href="#order-only-依赖" class="headerlink" title="order-only 依赖"></a>order-only 依赖</h2><p>依赖文件不存在时, 会执行对应的方法生成, 但依赖文件更新并不会导致目标文件的更新.<br>如果目标文件已存在, <code>order-only</code> 依赖中的文件即使修改时间比目标文件晚, 目标文件也不会更新.</p>
<p>定义方法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">targets: normal-prerequisites | order-only-prerequisites</span><br></pre></td></tr></table></figure>
<p><code>normal-prerequisites</code> 可以为空</p>
<h1 id="关于方法的一些问题"><a href="#关于方法的一些问题" class="headerlink" title="关于方法的一些问题"></a>关于方法的一些问题</h1><h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.PHONY : clean</span><br><span class="line">clean:</span><br><span class="line">	rm sudoku</span><br></pre></td></tr></table></figure>

<p>如上命令,当文件不存在时,会报错, 并且会退出 <code>make</code> 进程</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:sudoku_make$ make clean</span><br><span class="line">rm sudoku</span><br><span class="line">rm: cannot remove &#x27;sudoku&#x27;: No such file or directory</span><br><span class="line">make: *** [Makefile:27: clean] Error 1</span><br><span class="line">laolang@laolang-mint:sudoku_make$ </span><br></pre></td></tr></table></figure>

<p>解决方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.PHONY : clean</span><br><span class="line">clean:</span><br><span class="line">	- rm sudoku</span><br></pre></td></tr></table></figure>

<p>命令前加 <code>-</code> 虽然还是会报错,但是不会退出 <code>make</code> 进程</p>
<h2 id="禁止回显"><a href="#禁止回显" class="headerlink" title="禁止回显"></a>禁止回显</h2><h3 id="添加"><a href="#添加" class="headerlink" title="添加 @"></a>添加 @</h3><p>每一条命令都会回显, 可在命令前加 <code>@</code> 取消回显</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.PHONY : clean</span><br><span class="line">clean:</span><br><span class="line">	-@ rm -rf sudoku</span><br><span class="line">	-@ rm -rf block.o  command.o  i18n.o  input.o  main.o  scene.o</span><br></pre></td></tr></table></figure>

<h3 id="SILENT"><a href="#SILENT" class="headerlink" title=".SILENT"></a>.SILENT</h3><p>另一种方式是使用 <code>.SILENT</code> 显示指定不需要回显命令的目标</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.SILENT: hello</span><br><span class="line">hello:</span><br><span class="line">	@str=hello</span><br><span class="line">	echo $$str</span><br></pre></td></tr></table></figure>
<p>此时 <code>hello</code> 不会再输出命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:sudoku_make$ make hello</span><br><span class="line">hello</span><br><span class="line">laolang@laolang-mint:sudoku_make$ </span><br></pre></td></tr></table></figure>

<h3 id="s-选项"><a href="#s-选项" class="headerlink" title="-s 选项"></a>-s 选项</h3><p>也可以使用 <code>-s</code> 选项</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:sudoku_make$ make</span><br><span class="line">g++ -c block.cpp -o block.o</span><br><span class="line">g++ -c command.cpp -o command.o</span><br><span class="line">g++ -c i18n.cpp -o i18n.o</span><br><span class="line">g++ -c input.cpp -o input.o</span><br><span class="line">g++ -c main.cpp -o main.o</span><br><span class="line">g++ -c scene.cpp -o scene.o</span><br><span class="line">g++ -o sudoku block.o  command.o  i18n.o  input.o  main.o  scene.o</span><br><span class="line">laolang@laolang-mint:sudoku_make$ make clean</span><br><span class="line">laolang@laolang-mint:sudoku_make$ make -s</span><br><span class="line">laolang@laolang-mint:sudoku_make$ </span><br></pre></td></tr></table></figure>

<h2 id="显示要执行的命令"><a href="#显示要执行的命令" class="headerlink" title="显示要执行的命令"></a>显示要执行的命令</h2><p><code>make -n &lt;target&gt;</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:sudoku_make$ make clean</span><br><span class="line">laolang@laolang-mint:sudoku_make$ make clean -n</span><br><span class="line">rm -rf sudoku</span><br><span class="line">rm -rf block.o  command.o  i18n.o  input.o  main.o  scene.o</span><br><span class="line">laolang@laolang-mint:sudoku_make$ </span><br></pre></td></tr></table></figure>

<h2 id="共享-shell-进程"><a href="#共享-shell-进程" class="headerlink" title="共享 shell 进程"></a>共享 shell 进程</h2><p><code>make</code> 中每条命令都会开启一个独立的进程, 如果要在同一个进程中使用 <code>shell</code> 命令, 可使用 <code>.ONESHELL</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hello:</span><br><span class="line">	@str=hello</span><br><span class="line">	@echo $$str</span><br></pre></td></tr></table></figure>

<p>此时输出空白</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:sudoku_make$ make hello</span><br><span class="line"></span><br><span class="line">laolang@laolang-mint:sudoku_make$ </span><br></pre></td></tr></table></figure>

<p>添加 <code>.ONESHELL</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.ONESHELL:</span><br><span class="line">hello:</span><br><span class="line">	@str=hello</span><br><span class="line">	@echo $$str</span><br></pre></td></tr></table></figure>

<p>可以看到输出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:sudoku_make$ make hello</span><br><span class="line">hello</span><br><span class="line">laolang@laolang-mint:sudoku_make$ </span><br></pre></td></tr></table></figure>


<h1 id="使用变量简化-Makefile"><a href="#使用变量简化-Makefile" class="headerlink" title="使用变量简化 Makefile"></a>使用变量简化 Makefile</h1><h2 id="Makefile-变量简述"><a href="#Makefile-变量简述" class="headerlink" title="Makefile 变量简述"></a>Makefile 变量简述</h2><p>在 <code>Makefile</code> 中定义变量, 就像是在 <code>C/C++</code> 中定义宏一样, 即用一个名称代表一串文本. 但是 <code>Makefile</code> 的变量值是可以改变的, 定义后可以在目标、方法、依赖等 <code>Makefile</code> 中任意地方进行引用</p>
<p><strong>注意:</strong></p>
<blockquote>
<p><code>Makefile</code> 中的变量值只有一种类型: 字符串</p>
</blockquote>
<h2 id="定义变量"><a href="#定义变量" class="headerlink" title="定义变量"></a>定义变量</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># &lt;变量名&gt; = &lt;变量值&gt; &lt;变量名&gt; := &lt;变量值&gt; &lt;变量名&gt; ?= &lt;变量值&gt; &lt;变量名&gt; += &lt;变量值&gt;</span><br></pre></td></tr></table></figure>

<p>变量名区分大小写,且不能包含 <code>:</code> 、 <code>,</code> 、 <code>#</code> 、 <code>=</code></p>
<p>使用方式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># $(&lt;变量名&gt;) 或者 $&#123;&lt;变量名&gt;&#125;</span><br></pre></td></tr></table></figure>

<p>例如如下简化</p>
<blockquote>
<p>使用变量 <code>objs</code> 复用 <code>.o</code> 文件列表</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">.DEFAULT_GOAL = sudoku</span><br><span class="line"></span><br><span class="line">.SILENT: hello</span><br><span class="line"></span><br><span class="line">.ONESHELL:</span><br><span class="line"></span><br><span class="line">objs = block.o command.o i18n.o input.o main.o scene.o</span><br><span class="line"></span><br><span class="line">sudoku: $(objs)</span><br><span class="line">	g++ -o sudoku $(objs)</span><br><span class="line"></span><br><span class="line">block.o: block.cpp block.h common.h color.h display_symbol.h</span><br><span class="line">	g++ -c block.cpp -o block.o</span><br><span class="line"></span><br><span class="line">command.o: command.cpp scene.h common.h block.h command.h</span><br><span class="line">	g++ -c command.cpp -o command.o</span><br><span class="line"></span><br><span class="line">i18n.o: i18n.cpp i18n.h</span><br><span class="line">	g++ -c i18n.cpp -o i18n.o</span><br><span class="line"></span><br><span class="line">input.o: input.cpp common.h i18n.h utility.inl</span><br><span class="line">	g++ -c input.cpp -o input.o</span><br><span class="line"></span><br><span class="line">main.o: main.cpp i18n.h input.h common.h scene.h block.h command.h system_env.hpp utility.inl</span><br><span class="line">	g++ -c main.cpp -o main.o</span><br><span class="line"></span><br><span class="line">scene.o: scene.cpp scene.h common.h block.h command.h display_symbol.h i18n.h utility.inl color.h</span><br><span class="line">	g++ -c scene.cpp -o scene.o</span><br><span class="line"></span><br><span class="line">.PHONY : clean</span><br><span class="line">clean:</span><br><span class="line">	-@ rm -rf sudoku</span><br><span class="line">	-@ rm -rf $(objs)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Makefile-读取过程"><a href="#Makefile-读取过程" class="headerlink" title="Makefile 读取过程"></a>Makefile 读取过程</h2><p><code>GNU make</code> 分两个阶段来执行 <code>Makefile</code></p>
<p>第一阶段(读取阶段):</p>
<ul>
<li>读取 <code>Makefile</code> 文件的所有内容</li>
<li>根据 <code>Makefile</code> 的内容在程序内建立起变量</li>
<li>在程序内建起显示规则、隐式规则</li>
<li>建立目标和依赖之间的依赖图</li>
</ul>
<p>第二阶段(目标更新阶段):</p>
<ul>
<li>用第一阶段构建起来的数据确定哪个目标需要更新,然后执行对应的更新方法</li>
</ul>
<p>变量和函数的展开如果发生在第一节点, 就称作 <em>立即展开</em> , 否则称作 <em>延迟展开</em> . 立即展开的变量或函数都在第一阶段, 也就是 <code>Makefile</code> 呗读取解析的时候就进行展开. 延迟展开的变量或函数将会到用到的时候才会进行展开, 有一下两种情况:</p>
<ol>
<li>在一个立即展开的表达式中用到</li>
<li>在第二个阶段中用到</li>
</ol>
<p><strong>显示规则中, 目标和依赖部分是立即展开, 在更新方法中延迟展开</strong></p>
<h2 id="各种变量赋值方式"><a href="#各种变量赋值方式" class="headerlink" title="各种变量赋值方式"></a>各种变量赋值方式</h2><h3 id="递归展开赋值-延迟展开"><a href="#递归展开赋值-延迟展开" class="headerlink" title="&#x3D; 递归展开赋值(延迟展开)"></a>&#x3D; 递归展开赋值(延迟展开)</h3><p>第一中方式就是直接使用 <code>=</code>, 这种方式如果赋值的时候右边是其他变量或其他变量引用或函数调用之类的, 将不会做处理, 在使用到该变量的时候再进行处理得到变量值( <code>Makefile</code> 执行的第二个阶段再进行变量展开得到变量值)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">objs = a.cpp b.cpp</span><br><span class="line"></span><br><span class="line">files = $(objs)</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">	echo $(files)</span><br><span class="line"></span><br><span class="line">objs = a.o b.o</span><br></pre></td></tr></table></figure>

<p>运行效果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:tmp$ make -s</span><br><span class="line">a.o b.o</span><br><span class="line">laolang@laolang-mint:tmp$ </span><br></pre></td></tr></table></figure>

<h3 id="简单赋值-立即展开"><a href="#简单赋值-立即展开" class="headerlink" title=":&#x3D; 简单赋值(立即展开)"></a>:&#x3D; 简单赋值(立即展开)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">objs = a.cpp b.cpp</span><br><span class="line"></span><br><span class="line">files := $(objs)</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">	echo $(files)</span><br><span class="line"></span><br><span class="line">objs = a.o b.o</span><br></pre></td></tr></table></figure>

<p>运行效果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:tmp$ make -s</span><br><span class="line">a.cpp b.cpp</span><br><span class="line">laolang@laolang-mint:tmp$ </span><br></pre></td></tr></table></figure>

<h3 id="条件赋值-延迟展开"><a href="#条件赋值-延迟展开" class="headerlink" title="?&#x3D; 条件赋值(延迟展开)"></a>?&#x3D; 条件赋值(延迟展开)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">a = hello</span><br><span class="line">a ?= world</span><br><span class="line">b ?= world</span><br><span class="line">b ?= hello</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">	echo $(a) $(b)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>运行效果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:tmp$ make -s</span><br><span class="line">hello world</span><br><span class="line">laolang@laolang-mint:tmp$ </span><br></pre></td></tr></table></figure>

<h3 id="追加赋值-立即展开"><a href="#追加赋值-立即展开" class="headerlink" title="+&#x3D; 追加赋值(立即展开)"></a>+&#x3D; 追加赋值(立即展开)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CC = gcc</span><br><span class="line">CFLAGS += -Wall</span><br><span class="line">CFLAGS += -O3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hello: hello.o</span><br><span class="line">	gcc -o hello hello.o</span><br><span class="line"></span><br><span class="line">hello.o: main.c</span><br><span class="line">	$(CC) $(CFLAGS) -c main.c -o hello.o</span><br></pre></td></tr></table></figure>

<p>运行效果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:tmp$ make</span><br><span class="line">gcc -Wall -O3 -c main.c -o hello.o</span><br><span class="line">gcc -o hello hello.o</span><br><span class="line">laolang@laolang-mint:tmp$ </span><br></pre></td></tr></table></figure>

<h3 id="shell-运行赋值"><a href="#shell-运行赋值" class="headerlink" title="shell 运行赋值"></a>shell 运行赋值</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">work_dir != pwd</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">	echo $(work_dir)</span><br></pre></td></tr></table></figure>

<p>运行效果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:tmp$ make -s</span><br><span class="line">/home/laolang/code/make_study/tmp</span><br><span class="line">laolang@laolang-mint:tmp$ </span><br></pre></td></tr></table></figure>

<h2 id="定义多行变量"><a href="#定义多行变量" class="headerlink" title="定义多行变量"></a>定义多行变量</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">define msg</span><br><span class="line">echo hello</span><br><span class="line">echo world</span><br><span class="line">endef</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">	$(msg)</span><br></pre></td></tr></table></figure>

<p>运行效果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:tmp$ make -s</span><br><span class="line">hello</span><br><span class="line">world</span><br><span class="line">laolang@laolang-mint:tmp$ </span><br></pre></td></tr></table></figure>

<h2 id="取消变量"><a href="#取消变量" class="headerlink" title="取消变量"></a>取消变量</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">undefine &lt;变量名&gt;</span><br></pre></td></tr></table></figure>

<h2 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h2><p>直接使用即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">all:</span><br><span class="line">	echo $(PATH)</span><br></pre></td></tr></table></figure>

<p>运行效果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:tmp$ make -s</span><br><span class="line">/home/laolang/program/ninja/bin:/home/laolang/program/cmake/bin:/home/laolang/.local/bin:/home/laolang/program/ninja/bin:/home/laolang/program/cmake/bin:/home/laolang/.local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/home/laolang/.dotnet/tools</span><br><span class="line">laolang@laolang-mint:tmp$ </span><br></pre></td></tr></table></figure>

<h2 id="变量替换引用"><a href="#变量替换引用" class="headerlink" title="变量替换引用"></a>变量替换引用</h2><p>语法：$(var:a&#x3D;b)，意思是将变量var的值当中每一项结尾的a替换为b，直接上例子</p>
<p>也可以: <code>objs := $(files:%.cpp=%.o)</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">srcs = main.c</span><br><span class="line">objs := $(srcs:.c=.o)</span><br><span class="line"></span><br><span class="line">hello: $(objs)</span><br><span class="line">	gcc -o hello $(objs)</span><br><span class="line"></span><br><span class="line">$(objs): $(srcs)</span><br><span class="line">	gcc -c $(srcs) -o $(objs)</span><br></pre></td></tr></table></figure>

<p>运行效果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:tmp$ ls -l</span><br><span class="line">total 8</span><br><span class="line">-rw-rw-r-- 1 laolang laolang  77 11月 11 01:05 main.c</span><br><span class="line">-rw-rw-r-- 1 laolang laolang 118 11月 11 01:27 Makefile</span><br><span class="line">laolang@laolang-mint:tmp$ make</span><br><span class="line">gcc -c main.c -o main.o</span><br><span class="line">gcc -o hello main.o</span><br><span class="line">laolang@laolang-mint:tmp$ l</span><br><span class="line">total 28K</span><br><span class="line">-rwxrwxr-x 1 laolang laolang  16K 2024-11-11 01:27:33 hello*</span><br><span class="line">-rw-rw-r-- 1 laolang laolang   77 2024-11-11 01:05:25 main.c</span><br><span class="line">-rw-rw-r-- 1 laolang laolang 1.5K 2024-11-11 01:27:33 main.o</span><br><span class="line">-rw-rw-r-- 1 laolang laolang  118 2024-11-11 01:27:27 Makefile</span><br><span class="line">laolang@laolang-mint:tmp$ ./hello </span><br><span class="line"></span><br><span class="line">Hello World</span><br><span class="line">laolang@laolang-mint:tmp$ </span><br></pre></td></tr></table></figure>

<h2 id="变量覆盖"><a href="#变量覆盖" class="headerlink" title="变量覆盖"></a>变量覆盖</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">BUILD_TYPE := DEBUG</span><br><span class="line">all:</span><br><span class="line">	echo $(BUILD_TYPE)</span><br><span class="line">	</span><br></pre></td></tr></table></figure>

<p>运行效果</p>
<blockquote>
<p>注意: &#x3D; 两边不能有空格</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:tmp$ make -s</span><br><span class="line">DEBUG</span><br><span class="line">laolang@laolang-mint:tmp$ make BUILD_TYPE=RELEASE -s</span><br><span class="line">RELEASE</span><br><span class="line">laolang@laolang-mint:tmp$ </span><br></pre></td></tr></table></figure>

<h2 id="自动变量"><a href="#自动变量" class="headerlink" title="自动变量"></a>自动变量</h2><table>
    <thead>
        <tr>
            <td width="100" align="center">变量名</td>
            <td>含义</td>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td align="center">$@</td>
            <td>①本条规则的目标名；<br />②如果目标是归档文件的成员，则为归档文件名；<br />③在多目标的模式规则中, 为导致本条规则方法执行的那个目标名；</td>
        </tr>
        <tr>
            <td align="center">@<</td>
            <td>本条规则的第一个依赖名称</td>
        </tr>
        <tr>
            <td align="center">$?</td>
            <td>依赖中修改时间晚于目标文件修改时间的所有文件名，以空格隔开</td>
        </tr>
        <tr>
            <td align="center">$^</td>
            <td>所有依赖文件名，文件名不会重复，不包含order-only依赖</td>
        </tr>
        <tr>
            <td align="center">$+</td>
            <td>类似上一个， 表示所有依赖文件名，包括重复的文件名，不包含order-only依赖</td>
        </tr>
        <tr>
            <td align="center">$|</td>
            <td>所有order-only依赖文件名</td>
        </tr>
        <tr>
            <td align="center">$*</td>
            <td>：(简单理解)目标文件名的主干部分(即不包括后缀名)</td>
        </tr>
        <tr>
            <td align="center">$%</td>
            <td>如果目标不是归档文件，则为空；如果目标是归档文件成员，则为对应的成员文件名</td>
        </tr>
    </tbody>
</table>


<p>以下变量对应上述变量，D为对应变量所在的目录，结尾不带&#x2F;，F为对应变量除去目录部分的文件名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$(@D)</span><br><span class="line"></span><br><span class="line">$(@F)</span><br><span class="line"></span><br><span class="line">$(*D)</span><br><span class="line"></span><br><span class="line">$(*F)</span><br><span class="line"></span><br><span class="line">$(%D)</span><br><span class="line"></span><br><span class="line">$(%F)</span><br><span class="line"></span><br><span class="line">$(&lt;D)</span><br><span class="line"></span><br><span class="line">$(&lt;F)</span><br><span class="line"></span><br><span class="line">$(^D)</span><br><span class="line"></span><br><span class="line">$(^F)</span><br><span class="line"></span><br><span class="line">$(+D)</span><br><span class="line"></span><br><span class="line">$(+F)</span><br><span class="line"></span><br><span class="line">$(?D)</span><br><span class="line"></span><br><span class="line">$(?F)</span><br></pre></td></tr></table></figure>

<p>例如修改 <code>sudoku</code> 的 <code>Makefile</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">CXX = g++</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.DEFAULT_GOAL = sudoku</span><br><span class="line"></span><br><span class="line">.SILENT: hello</span><br><span class="line"></span><br><span class="line">.ONESHELL:</span><br><span class="line"></span><br><span class="line">objs = block.o command.o i18n.o input.o main.o scene.o</span><br><span class="line"></span><br><span class="line">sudoku: $(objs)</span><br><span class="line">	$(CXX) -o $@ $^</span><br><span class="line"></span><br><span class="line">block.o: block.cpp block.h common.h color.h display_symbol.h</span><br><span class="line">	$(CXX) -c $&lt; -o $@</span><br><span class="line"></span><br><span class="line">command.o: command.cpp scene.h common.h block.h command.h</span><br><span class="line">	$(CXX) -c $&lt; -o $@</span><br><span class="line"></span><br><span class="line">i18n.o: i18n.cpp i18n.h</span><br><span class="line">	$(CXX) -c $&lt; -o $@</span><br><span class="line"></span><br><span class="line">input.o: input.cpp common.h i18n.h utility.inl</span><br><span class="line">	$(CXX) -c $&lt; -o $@</span><br><span class="line"></span><br><span class="line">main.o: main.cpp i18n.h input.h common.h scene.h block.h command.h system_env.hpp utility.inl</span><br><span class="line">	$(CXX) -c $&lt; -o $@</span><br><span class="line"></span><br><span class="line">scene.o: scene.cpp scene.h common.h block.h command.h display_symbol.h i18n.h utility.inl color.h</span><br><span class="line">	$(CXX) -c $&lt; -o $@</span><br><span class="line"></span><br><span class="line">.PHONY : clean</span><br><span class="line">clean:</span><br><span class="line">	-@ rm -rf sudoku</span><br><span class="line">	-@ rm -rf $(objs)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>运行效果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:sudoku_make$ make</span><br><span class="line">g++ -c block.cpp -o block.o</span><br><span class="line">g++ -c command.cpp -o command.o</span><br><span class="line">g++ -c i18n.cpp -o i18n.o</span><br><span class="line">g++ -c input.cpp -o input.o</span><br><span class="line">g++ -c main.cpp -o main.o</span><br><span class="line">g++ -c scene.cpp -o scene.o</span><br><span class="line">g++ -o sudoku block.o command.o i18n.o input.o main.o scene.o</span><br><span class="line">laolang@laolang-mint:sudoku_make$ </span><br></pre></td></tr></table></figure>

<h2 id="绑定目标的变量"><a href="#绑定目标的变量" class="headerlink" title="绑定目标的变量"></a>绑定目标的变量</h2><p>Makefile中的变量一般是全局变量。也就是说定义之后在Makefile的任意位置都可以使用。但也可以将变量指定在某个目标的范围内，这样这个变量就只能在这个目标对应的规则里面保用</p>
<p>语法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">target … : variable-assignment</span><br><span class="line">target … : prerequisites</span><br><span class="line">    recipes</span><br><span class="line">    …</span><br></pre></td></tr></table></figure>


<p>例一</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var1 = Global Var</span><br><span class="line"></span><br><span class="line">first: all t2</span><br><span class="line"></span><br><span class="line">all: var2 = Target All Var</span><br><span class="line">all:</span><br><span class="line">	@echo $(var1)</span><br><span class="line">	@echo $(var2)</span><br><span class="line"></span><br><span class="line">t2:</span><br><span class="line">	@echo $(var1)</span><br><span class="line">	@echo $(var2) # 空白输出</span><br></pre></td></tr></table></figure>

<p>运行效果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:tmp$ make </span><br><span class="line">Global Var</span><br><span class="line">Target All Var</span><br><span class="line">Global Var</span><br><span class="line"></span><br><span class="line">laolang@laolang-mint:tmp$ </span><br></pre></td></tr></table></figure>

<p>这种定义变量的方式，目标也可以使用模式匹配，这样所有能匹配上的目标范围内都可以使用这些变量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">var1 = Global Var</span><br><span class="line"></span><br><span class="line">first: all.v t2.v t3</span><br><span class="line"></span><br><span class="line">%.v: var2 = Target %.v Var</span><br><span class="line">all.v:</span><br><span class="line">	@echo $@ -- $(var1)</span><br><span class="line">	@echo $@ -- $(var2) # 模式匹配</span><br><span class="line"></span><br><span class="line">t2.v:</span><br><span class="line">	@echo $@ -- $(var1)</span><br><span class="line">	@echo $@ -- $(var2) # 模式匹配</span><br><span class="line">t3:</span><br><span class="line">	@echo $@ -- $(var1)</span><br><span class="line">	@echo $@ -- $(var2) # 空白输出</span><br></pre></td></tr></table></figure>

<p>运行效果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:tmp$ make </span><br><span class="line">all.v -- Global Var</span><br><span class="line">all.v -- Target %.v Var</span><br><span class="line">t2.v -- Global Var</span><br><span class="line">t2.v -- Target %.v Var</span><br><span class="line">t3 -- Global Var</span><br><span class="line">t3 --</span><br><span class="line">laolang@laolang-mint:tmp$ </span><br></pre></td></tr></table></figure>

<h2 id="二次展开"><a href="#二次展开" class="headerlink" title="二次展开"></a>二次展开</h2><p>前面说过依赖中的变量都是在Makefile读取阶段立即展开的。如果想让依赖的的变量延迟展开，可以使用.SECONDEXPANSION:，添加之后，在依赖中使用变量时用$$，可以让变量在第二阶段进行二次展开，从而达到延迟展开的效果。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">VAR1 = hello.c</span><br><span class="line">.SECONDEXPANSION:</span><br><span class="line">all: $$(VAR1)</span><br><span class="line">	@echo $^</span><br><span class="line"></span><br><span class="line">VAR1 = main.c</span><br></pre></td></tr></table></figure>

<p>运行效果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:tmp$ make</span><br><span class="line">main.c</span><br><span class="line">laolang@laolang-mint:tmp$ </span><br></pre></td></tr></table></figure>

<h1 id="自动推到与隐式规则"><a href="#自动推到与隐式规则" class="headerlink" title="自动推到与隐式规则"></a>自动推到与隐式规则</h1><p>Makefile中有一些生成目标文件的规则使用频率非常高，比如由.c或.cpp文件编译成.o文件，这样的规则在make中可以自动推导，所以可以不用明确写出来，这样的规则称为隐式规则。</p>
<h2 id="一些-make-预定义的规则"><a href="#一些-make-预定义的规则" class="headerlink" title="一些 make 预定义的规则"></a>一些 make 预定义的规则</h2><h3 id="C-语言编译"><a href="#C-语言编译" class="headerlink" title="C 语言编译"></a>C 语言编译</h3><p>从 <code>.c</code> 到 <code>.o</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(CC) $(CPPFLAGS) $(CFLAGS) -c</span><br></pre></td></tr></table></figure>

<h3 id="C-编译"><a href="#C-编译" class="headerlink" title="C++ 编译"></a>C++ 编译</h3><p>从 <code>.cpp</code> 到 <code>.o</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c</span><br></pre></td></tr></table></figure>

<h3 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h3><p>由 .o 文件链接到可执行文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(CC) $(LDFLAGS) *.o $(LOADLIBES) $(LDLIBS)</span><br></pre></td></tr></table></figure>

<h2 id="隐式规则中常用的一些变量"><a href="#隐式规则中常用的一些变量" class="headerlink" title="隐式规则中常用的一些变量"></a>隐式规则中常用的一些变量</h2><table>
    <thead>
        <tr>
            <td width="100" align="center">变量名</td>
            <td>含义</td>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td align="center">CC</td>
            <td>编译 C 语言的程序, 默认为: `cc`</td>
        </tr>
        <tr>
            <td align="center">CXX</td>
            <td>编译 C++ 的程序, 默认为: `g++`</td>
        </tr>
        <tr>
            <td align="center">AR</td>
            <td>归档程序, 默认为: `ar`</td>
        </tr>
        <tr>
            <td align="center">CFLAGS</td>
            <td>传递给 C 编译器的一些选项, 例如: `-O2 -linclude`</td>
        </tr>
        <tr>
            <td align="center">CXXFLAGS</td>
            <td>传递给 C 编译器的一些选项, 例如: `-std=c++ 11 -fexec-charset=GBK`</td>
        </tr>
        <tr>
            <td align="center">CPPFLAGS</td>
            <td>预处理的一些选项</td>
        </tr>
        <tr>
            <td align="center">LDFLAGS</td>
            <td>链接选项，如 `-L`</td>
        </tr>
        <tr>
            <td align="center">LDLIBS</td>
            <td>链接需要用到的库，如 `-lkernel32 -luser32 -lgdi32`</td>
        </tr>
    </tbody>
</table>

<h2 id="多目标与多规则"><a href="#多目标与多规则" class="headerlink" title="多目标与多规则"></a>多目标与多规则</h2><p>显式规则中一条规则可以有多个目标，多个目标可以是相互独立的目标，也可以是组合目标，用写法来区分</p>
<h3 id="独立多目标"><a href="#独立多目标" class="headerlink" title="独立多目标"></a>独立多目标</h3><p>相互独立的多个目标与依赖之间直接用 <code>:</code> ，常用这种方式的有以下两种情况</p>
<ol>
<li><p>只需要写目标和依赖，不需要写方法的时候</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">block.o input.o scene.o : common.h</span><br></pre></td></tr></table></figure>
<p>这种写法等价于</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">block.o : common.h</span><br><span class="line">input.o : common.h</span><br><span class="line">scene.o : common.h</span><br></pre></td></tr></table></figure>
</li>
<li><p>生成(更新)目标的方法写法一样的，只是依赖与目标不一样时。之前写的Makfile中，有如下代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">block.o: block.cpp common.h block.h color.h</span><br><span class="line">    g++ -c block.cpp</span><br><span class="line">command.o: command.cpp command.h scene.h</span><br><span class="line">    g++ -c command.cpp</span><br><span class="line">input.o: input.cpp common.h utility.inl</span><br><span class="line">    g++ -c input.cpp</span><br><span class="line">main.o: main.cpp scene.h input.h test.h</span><br><span class="line">    g++ -c main.cpp</span><br><span class="line">scene.o: scene.cpp common.h scene.h utility.inl</span><br><span class="line">    g++ -c scene.cpp</span><br><span class="line">test.o: test.cpp test.h</span><br><span class="line">    g++ -c test.cpp</span><br></pre></td></tr></table></figure>
<p>所有.o文件的生成都用的同一方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ -c &lt;文件名&gt;</span><br></pre></td></tr></table></figure>
<p>如果不考虑依赖源文件进行更新时，可以进行简写如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">block.o command.o input.o main.o scene.o test.o : common.h block.h command.h ...</span><br><span class="line">    g++ -c $(@:%.o=%.cpp)</span><br></pre></td></tr></table></figure>
<p>这种写法实际上等价于</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">block.o : common.h block.h command.h ...</span><br><span class="line">    g++ -c $(subst .o,.cpp,$@)</span><br><span class="line">command.o : common.h block.h command.h ...</span><br><span class="line">    g++ -c $(subst .o,.cpp,$@)</span><br><span class="line">input.o : common.h block.h command.h ...</span><br><span class="line">    g++ -c $(subst .o,.cpp,$@)</span><br><span class="line">main.o : common.h block.h command.h ...</span><br><span class="line">    g++ -c $(subst .o,.cpp,$@)</span><br><span class="line">scene.o : common.h block.h command.h ...</span><br><span class="line">    g++ -c $(subst .o,.cpp,$@)</span><br><span class="line">test.o : common.h block.h command.h ...</span><br><span class="line">    g++ -c $(subst .o,.cpp,$@)</span><br></pre></td></tr></table></figure>
<p>其中，@表示的是目标名称。subst是一个字符串替换函数，<code>(subst .o,.cpp,$@)</code> 表示将目标名称中的 <code>.o</code> 替换为 <code>.cpp</code> 。<br>这样的简写可以减少内容的书写量，但是不利于将每个目标与依赖分别对应。</p>
</li>
</ol>
<p>例如更新 sudoku Makefile</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">CXX = g++</span><br><span class="line">CXXFLAGS = -Wall</span><br><span class="line">.DEFAULT_GOAL = sudoku</span><br><span class="line"></span><br><span class="line">.SILENT: hello</span><br><span class="line"></span><br><span class="line">.ONESHELL:</span><br><span class="line"></span><br><span class="line">objs = block.o command.o i18n.o input.o main.o scene.o</span><br><span class="line"></span><br><span class="line">sudoku: $(objs)</span><br><span class="line">	$(CXX) -o $@ $^</span><br><span class="line"></span><br><span class="line">$(objs):</span><br><span class="line">	$(CXX) $(CXXFLAGS) -c $(@:%.o=%.cpp)</span><br><span class="line"></span><br><span class="line">.PHONY : clean</span><br><span class="line">clean:</span><br><span class="line">	-@ rm -rf sudoku</span><br><span class="line">	-@ rm -rf $(objs)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>运行效果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:sudoku_make$ make</span><br><span class="line">g++ -Wall -c block.cpp</span><br><span class="line">g++ -Wall -c command.cpp</span><br><span class="line">g++ -Wall -c i18n.cpp</span><br><span class="line">g++ -Wall -c input.cpp</span><br><span class="line">g++ -Wall -c main.cpp</span><br><span class="line">g++ -Wall -c scene.cpp</span><br><span class="line">g++ -o sudoku block.o command.o i18n.o input.o main.o scene.o</span><br><span class="line">laolang@laolang-mint:sudoku_make$ </span><br></pre></td></tr></table></figure>

<h3 id="组合多目标"><a href="#组合多目标" class="headerlink" title="组合多目标"></a>组合多目标</h3><p>多目标与依赖之前用 <code>&amp;:</code>，这样的多个目标称为组合目标。与独立多目标的区别在于，独立多目标每个目标的更新需要单独调用一次更新方法。而组合多目标调用一次方法将更新所有目标</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">block.o input.o scene.o &amp;: block.cpp input.cpp scene.cpp common.h</span><br><span class="line">    g++ -c block.cpp</span><br><span class="line">    g++ -c input.cpp</span><br><span class="line">    g++ -c scene.cpp</span><br></pre></td></tr></table></figure>

<p>所有目标的更新方法都写到其中，每次更新只会调用一次。</p>
<h3 id="同一目标多条规则"><a href="#同一目标多条规则" class="headerlink" title="同一目标多条规则"></a>同一目标多条规则</h3><p>同一目标可以对应多条规则。同一目标的所有规则中的依赖会被合并。但如果同一目标对应的多条规则都写了更新方法，则会使用最新的一条更新方法，并且会输出警告信息。</p>
<p>同一目标多规则通常用来给多个目标添加依赖而不用改动已写好的部分。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">input.o: input.cpp utility.inl</span><br><span class="line">    g++ -c input.cpp</span><br><span class="line">main.o: main.cpp scene.h input.h test.h</span><br><span class="line">    g++ -c main.cpp</span><br><span class="line">scene.o: scene.cpp scene.h utility.inl</span><br><span class="line">    g++ -c scene.cpp</span><br><span class="line"></span><br><span class="line">input.o main.o scene.o : common.h</span><br></pre></td></tr></table></figure>

<p>同时给三个目标添加了一个依赖common.h，但是不用修改上面已写好的部分。</p>
<h2 id="静态模式"><a href="#静态模式" class="headerlink" title="静态模式"></a>静态模式</h2><p>独立多目标可以简化Makefile的书写，但是不利于将各个目标的依赖分开，让目标文件根据各自的依赖进行更新。静态模式可以在一定程度上改进依赖分开问题。</p>
<p>静态模式就是用 <code>%</code> 进行文件匹配来推导出对应的依赖。</p>
<p>语法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">targets …: target-pattern(目标模式): prereq-patterns(依赖模式) …</span><br><span class="line">        recipe</span><br><span class="line">        …</span><br></pre></td></tr></table></figure>

<p>先看一个例子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">block.o : %.o : %.cpp %.h</span><br><span class="line">    g++ -c $&lt;</span><br></pre></td></tr></table></figure>

<p>block.o为目标，%.o为目标模式，%.cpp，%.h为依赖模式，对于这一条规则，%.o代表的是目标文件block.o，所以这里的%匹配的是block，因此，%.cpp表示block.cpp，%.h代表block.h，所以block.o : %.o : %.cpp %.h表示的意思同下面这种写法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">block.o : block.cpp block.h</span><br></pre></td></tr></table></figure>
<p>自动推导出block.o依赖block.cpp和block.h。</p>
<p>另外，&lt;表示目标的第一个依赖，在这条规则中，<br>&lt;表示block.cpp</p>
<p>对应的Makefile可以做如下改进</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">block.o command.o input.o scene.o test.o: %.o : %.cpp %.h</span><br><span class="line">    g++ -c $&lt;</span><br><span class="line">main.o: main.cpp scene.h input.h test.h</span><br><span class="line">    g++ -c main.cpp</span><br></pre></td></tr></table></figure>

<p>用这种方式可以在简写的同时一定程度上解决各个目标对应的依赖问题。</p>
<p>(不属于静态模式的内容，隐式规则的内容)利用模式匹配可以直接将所有.cpp到.o文件的编译简写为如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%.o : %.cpp %.h</span><br><span class="line">    g++ -c $&lt;</span><br></pre></td></tr></table></figure>

<p>修正 sudoku Makefile 如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">CXX = g++</span><br><span class="line">CXXFLAGS = -Wall</span><br><span class="line">.DEFAULT_GOAL = sudoku</span><br><span class="line"></span><br><span class="line">.SILENT: hello</span><br><span class="line"></span><br><span class="line">.ONESHELL:</span><br><span class="line"></span><br><span class="line">objs = block.o command.o i18n.o input.o scene.o</span><br><span class="line"></span><br><span class="line">sudoku: $(objs) main.o</span><br><span class="line">	$(CXX) -o $@ $^</span><br><span class="line"></span><br><span class="line">main.o: %.o : %.cpp</span><br><span class="line">	$(CXX) $(CXXFLAGS) -c $&lt;</span><br><span class="line"></span><br><span class="line">$(objs): %.o : %.cpp %.h</span><br><span class="line">	$(CXX) $(CXXFLAGS) -c $&lt;</span><br><span class="line"></span><br><span class="line">.PHONY : clean</span><br><span class="line">clean:</span><br><span class="line">	-@ rm -rf sudoku</span><br><span class="line">	-@ rm -rf $(objs)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>运行如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:sudoku_make$ make</span><br><span class="line">g++ -Wall -c block.cpp</span><br><span class="line">g++ -Wall -c command.cpp</span><br><span class="line">g++ -Wall -c i18n.cpp</span><br><span class="line">g++ -Wall -c input.cpp</span><br><span class="line">g++ -Wall -c scene.cpp</span><br><span class="line">g++ -o sudoku block.o command.o i18n.o input.o scene.o main.o</span><br><span class="line">laolang@laolang-mint:sudoku_make$</span><br></pre></td></tr></table></figure>

<p>修改 block.h 之后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">laolang@laolang-mint:sudoku_make$ make</span><br><span class="line">g++ -Wall -c block.cpp</span><br><span class="line">g++ -o sudoku block.o command.o i18n.o input.o scene.o main.o</span><br><span class="line">laolang@laolang-mint:sudoku_make$ </span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://laolang2016.github.io">潼关路边的一只野鬼</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://laolang2016.github.io/2024/11/09/makefile-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/">https://laolang2016.github.io/2024/11/09/makefile-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://laolang2016.github.io" target="_blank">野鬼圣经</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/c/">c++</a><a class="post-meta__tags" href="/tags/makefile/">makefile</a></div><div class="post_share"><div class="social-share" data-image="/upload/avatar.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/upload/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">潼关路边的一只野鬼</div><div class="author-info__description">论鬼是如何变成人的</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">87</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">66</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">71</div></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84-Makefile"><span class="toc-number">1.</span> <span class="toc-text">一个最简单的 Makefile</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-number">1.1.</span> <span class="toc-text">目录结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BA%90%E7%A0%81"><span class="toc-number">1.2.</span> <span class="toc-text">源码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#hello-cpp"><span class="toc-number">1.2.1.</span> <span class="toc-text">hello.cpp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Makefile"><span class="toc-number">1.2.2.</span> <span class="toc-text">Makefile</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">1.3.</span> <span class="toc-text">使用过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E4%B8%A4%E6%AD%A5%E7%BC%96%E8%AF%91"><span class="toc-number">1.4.</span> <span class="toc-text">分两步编译</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Makefile-1"><span class="toc-number">1.4.1.</span> <span class="toc-text">Makefile</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%BF%87%E7%A8%8B-1"><span class="toc-number">1.4.2.</span> <span class="toc-text">使用过程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Makefile-%E6%96%87%E4%BB%B6%E5%90%8D%E7%9A%84%E5%91%BD%E5%90%8D%E4%B8%8E%E6%8C%87%E5%AE%9A"><span class="toc-number">2.</span> <span class="toc-text">Makefile 文件名的命名与指定</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%BD%E5%90%8D%E6%96%B9%E5%BC%8F"><span class="toc-number">2.1.</span> <span class="toc-text">命名方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%8C%87%E5%AE%9A-Makefile-%E6%96%87%E4%BB%B6"><span class="toc-number">2.2.</span> <span class="toc-text">如何指定 Makefile 文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E7%95%A5%E5%A4%8D%E6%9D%82%E7%9A%84-Makefile"><span class="toc-number">3.</span> <span class="toc-text">一个略复杂的 Makefile</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BA%90%E7%A0%81%E4%B8%8B%E8%BD%BD"><span class="toc-number">3.1.</span> <span class="toc-text">源码下载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84-1"><span class="toc-number">3.2.</span> <span class="toc-text">目录结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E7%AE%80%E7%95%A5%E7%9A%84-Makefile"><span class="toc-number">3.3.</span> <span class="toc-text">一个简略的 Makefile</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A%E6%96%87%E4%BB%B6%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">3.3.1.</span> <span class="toc-text">确定文件依赖关系的方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Makefile-%E5%86%85%E5%AE%B9"><span class="toc-number">3.3.2.</span> <span class="toc-text">Makefile 内容</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E8%BF%87%E7%A8%8B"><span class="toc-number">3.4.</span> <span class="toc-text">编译过程</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%9B%AE%E6%A0%87%E4%B8%8E%E4%BC%AA%E7%9B%AE%E6%A0%87"><span class="toc-number">4.</span> <span class="toc-text">目标与伪目标</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96"><span class="toc-number">5.</span> <span class="toc-text">依赖</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E7%B1%BB%E5%9E%8B"><span class="toc-number">5.1.</span> <span class="toc-text">依赖类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#order-only-%E4%BE%9D%E8%B5%96"><span class="toc-number">5.2.</span> <span class="toc-text">order-only 依赖</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E6%96%B9%E6%B3%95%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98"><span class="toc-number">6.</span> <span class="toc-text">关于方法的一些问题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4"><span class="toc-number">6.1.</span> <span class="toc-text">删除</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A6%81%E6%AD%A2%E5%9B%9E%E6%98%BE"><span class="toc-number">6.2.</span> <span class="toc-text">禁止回显</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0"><span class="toc-number">6.2.1.</span> <span class="toc-text">添加 @</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SILENT"><span class="toc-number">6.2.2.</span> <span class="toc-text">.SILENT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#s-%E9%80%89%E9%A1%B9"><span class="toc-number">6.2.3.</span> <span class="toc-text">-s 选项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E8%A6%81%E6%89%A7%E8%A1%8C%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="toc-number">6.3.</span> <span class="toc-text">显示要执行的命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B1%E4%BA%AB-shell-%E8%BF%9B%E7%A8%8B"><span class="toc-number">6.4.</span> <span class="toc-text">共享 shell 进程</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%98%E9%87%8F%E7%AE%80%E5%8C%96-Makefile"><span class="toc-number">7.</span> <span class="toc-text">使用变量简化 Makefile</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Makefile-%E5%8F%98%E9%87%8F%E7%AE%80%E8%BF%B0"><span class="toc-number">7.1.</span> <span class="toc-text">Makefile 变量简述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F"><span class="toc-number">7.2.</span> <span class="toc-text">定义变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Makefile-%E8%AF%BB%E5%8F%96%E8%BF%87%E7%A8%8B"><span class="toc-number">7.3.</span> <span class="toc-text">Makefile 读取过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%84%E7%A7%8D%E5%8F%98%E9%87%8F%E8%B5%8B%E5%80%BC%E6%96%B9%E5%BC%8F"><span class="toc-number">7.4.</span> <span class="toc-text">各种变量赋值方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%92%E5%BD%92%E5%B1%95%E5%BC%80%E8%B5%8B%E5%80%BC-%E5%BB%B6%E8%BF%9F%E5%B1%95%E5%BC%80"><span class="toc-number">7.4.1.</span> <span class="toc-text">&#x3D; 递归展开赋值(延迟展开)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E8%B5%8B%E5%80%BC-%E7%AB%8B%E5%8D%B3%E5%B1%95%E5%BC%80"><span class="toc-number">7.4.2.</span> <span class="toc-text">:&#x3D; 简单赋值(立即展开)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E8%B5%8B%E5%80%BC-%E5%BB%B6%E8%BF%9F%E5%B1%95%E5%BC%80"><span class="toc-number">7.4.3.</span> <span class="toc-text">?&#x3D; 条件赋值(延迟展开)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%BD%E5%8A%A0%E8%B5%8B%E5%80%BC-%E7%AB%8B%E5%8D%B3%E5%B1%95%E5%BC%80"><span class="toc-number">7.4.4.</span> <span class="toc-text">+&#x3D; 追加赋值(立即展开)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shell-%E8%BF%90%E8%A1%8C%E8%B5%8B%E5%80%BC"><span class="toc-number">7.4.5.</span> <span class="toc-text">shell 运行赋值</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E5%A4%9A%E8%A1%8C%E5%8F%98%E9%87%8F"><span class="toc-number">7.5.</span> <span class="toc-text">定义多行变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%96%E6%B6%88%E5%8F%98%E9%87%8F"><span class="toc-number">7.6.</span> <span class="toc-text">取消变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">7.7.</span> <span class="toc-text">环境变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%98%E9%87%8F%E6%9B%BF%E6%8D%A2%E5%BC%95%E7%94%A8"><span class="toc-number">7.8.</span> <span class="toc-text">变量替换引用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96"><span class="toc-number">7.9.</span> <span class="toc-text">变量覆盖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%8F%98%E9%87%8F"><span class="toc-number">7.10.</span> <span class="toc-text">自动变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%91%E5%AE%9A%E7%9B%AE%E6%A0%87%E7%9A%84%E5%8F%98%E9%87%8F"><span class="toc-number">7.11.</span> <span class="toc-text">绑定目标的变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E6%AC%A1%E5%B1%95%E5%BC%80"><span class="toc-number">7.12.</span> <span class="toc-text">二次展开</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E6%8E%A8%E5%88%B0%E4%B8%8E%E9%9A%90%E5%BC%8F%E8%A7%84%E5%88%99"><span class="toc-number">8.</span> <span class="toc-text">自动推到与隐式规则</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B-make-%E9%A2%84%E5%AE%9A%E4%B9%89%E7%9A%84%E8%A7%84%E5%88%99"><span class="toc-number">8.1.</span> <span class="toc-text">一些 make 预定义的规则</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#C-%E8%AF%AD%E8%A8%80%E7%BC%96%E8%AF%91"><span class="toc-number">8.1.1.</span> <span class="toc-text">C 语言编译</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#C-%E7%BC%96%E8%AF%91"><span class="toc-number">8.1.2.</span> <span class="toc-text">C++ 编译</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%93%BE%E6%8E%A5"><span class="toc-number">8.1.3.</span> <span class="toc-text">链接</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9A%90%E5%BC%8F%E8%A7%84%E5%88%99%E4%B8%AD%E5%B8%B8%E7%94%A8%E7%9A%84%E4%B8%80%E4%BA%9B%E5%8F%98%E9%87%8F"><span class="toc-number">8.2.</span> <span class="toc-text">隐式规则中常用的一些变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E7%9B%AE%E6%A0%87%E4%B8%8E%E5%A4%9A%E8%A7%84%E5%88%99"><span class="toc-number">8.3.</span> <span class="toc-text">多目标与多规则</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8B%AC%E7%AB%8B%E5%A4%9A%E7%9B%AE%E6%A0%87"><span class="toc-number">8.3.1.</span> <span class="toc-text">独立多目标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E5%A4%9A%E7%9B%AE%E6%A0%87"><span class="toc-number">8.3.2.</span> <span class="toc-text">组合多目标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8C%E4%B8%80%E7%9B%AE%E6%A0%87%E5%A4%9A%E6%9D%A1%E8%A7%84%E5%88%99"><span class="toc-number">8.3.3.</span> <span class="toc-text">同一目标多条规则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E6%A8%A1%E5%BC%8F"><span class="toc-number">8.4.</span> <span class="toc-text">静态模式</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By 潼关路边的一只野鬼</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid@10.8.0/dist/mermaid.min.js').then(runMermaid)
  }

  btf.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div></body></html>